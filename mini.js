function t(t){return document.getElementById(t)}function e(t){return document.createElement(t)}function n(n){var o=e("canvas");o.id=n,o.width=J.cvs.width,o.height=J.cvs.height,o.style="image-rendering:pixelated;image-rendering: crisp-edges;display:none",document.body.appendChild(o),J[n+"cvs"]=t(n),J[n+"ctx"]=J[n+"cvs"].getContext("2d")}function o(){try{input}catch(t){it=!1}!function(){(function(){xe=e("select"),be=e("select");for(var t=0;t<Ee.length;t++){var n=e("option"),o=Ee[t].lastIndexOf("/");n.innerText=-1===o?Ee[t]:Ee[t].substring(o+1),n.value=t,xe.appendChild(n)}})(),function(){Y.x=0,Y.y=0,Y.angle=0,Y.zoom=1,ot=0,at=0,nt=!0;for(var t=0;t<Se.length;t++){for(var n=[],o=0,a=Ne[Se[t]].prototype.typesAmount;o<a;o++){var i=new Ne[Se[t]](.5,.5,t,o,0),r=e("canvas");r.width=16,r.height=16;var s=r.getContext("2d");U=s,i.draw(),n.push(s.getImageData(0,0,16,16))}He.push(n)}}(),function(){for(var t=0;t<256;t++){var n=t.toString(2).padStart(8,"0"),o=e("canvas");o.width=22,o.height=22;var a=o.getContext("2d");"0"===n[0]&&"1"!==n[7]&&"1"!==n[1]&&(a.setTransform(1,0,0,1,11,11),a.drawImage(yt.shadowCorner.spr,-11,-11),a.setTransform(1,0,0,1,0,0));for(var i=2;i<8;i+=2)(check="0"===n[i]&&"1"!==n[i-1]&&"1"!==n[i+1])&&(a.setTransform(1,0,0,1,11,11),a.rotate(i*Ot/2),a.drawImage(yt.shadowCorner.spr,-11,-11),a.setTransform(1,0,0,1,0,0));for(i=1;i<8;i+=2)"0"===n[i]&&(a.setTransform(1,0,0,1,11,11),a.rotate((i-1)*Ot/2),a.drawImage(yt.shadowSide.spr,-11,-11),a.setTransform(1,0,0,1,0,0));Pe[n]=o}}(),ne(2);for(var t=0;t<100;t++)Wt.push(new Qt(i(0,600),i(0,600),14,14,i(0,63)/10)),Wt[t].updateCount=i(0,50)}(),requestAnimationFrame(Ct),setInterval(Pt,1e3/_),it&&setInterval(St,4)}function a(){if(0===et)return{x:T.x-Y.x,y:T.y-Y.y};if(1===et){var t=J.cvs.width/2,e=J.cvs.height/2;return{x:(T.x-t)/Y.zoom+t-Y.x,y:(T.y-e)/Y.zoom+e-Y.y}}t=J.cvs.width/2,e=J.cvs.height/2;var n={x:(T.x-t)/Y.zoom+t-Y.x,y:(T.y-e)/Y.zoom+e-Y.y},o={x:-Y.x+G/2,y:-Y.y+F/2},a=r(o,n)-Y.angle,i=z(o,n);return{x:o.x+Math.cos(a)*i,y:o.y+Math.sin(a)*i}}function i(t,e){return Math.floor(Math.random()*(e-t+1))+t}function r(t,e){var n=e.x-t.x,o=e.y-t.y;return Math.atan2(o,n)}function s(){Object.keys(yt).length==ft.length&&vt.length==It?(o(),ft=[],vt=[],gt=[]):(U.fillStyle="#2d2d2d",U.fillRect(0,0,G,F),y(`audio:   ${It}/${vt.length}`,10,30,"white",2),y(`sprites: ${Object.keys(yt).length}/${ft.length}`,10,10,"white",2),U.setTransform(1,0,0,1,Math.round(G/2),Math.round(F/2)),U.rotate(st),st+=.1,U.drawImage(X,Math.round(-8),Math.round(-8)),U.setTransform(1,0,0,1,0,0),requestAnimationFrame(s))}function l(t,e){let n,o=t.lastIndexOf(".");for(let e=o-1;kt.includes(t[e]);e--)n=e;let a=t.slice(n,o),i=Math.max(e.width,e.height)/2;yt[a]={spr:e,drawLimitSize:i}}function c(t){let e,n=t.lastIndexOf(".");for(let o=n-1;kt.includes(t[o]);o--)e=o;let o=t.slice(e,n);xt[o]={nodes:[],volNodes:[],src:t,type:"sfx",volume:1},xt[o].nodes=[1];let a=new Audio;a.onerror=function(){console.warn(rt+" "+t+" was not found")},a.src=t,a.preload="auto",a.addEventListener("canplaythrough",(function(){It++}),!1),xt[o].nodes.push(a);let i=Et.createMediaElementSource(a),r=Et.createGain();i.connect(r),r.connect(Mt),bt.push(i),wt.push(r),xt[o].volNodes.push(wt.length-1)}function h(){ht&&E[0]&&(R(ut.sfx,T)&&(At.sfx=(T.x-(ut.sfx.x-60))/120),R(ut.bmg,T)&&(At.bgm=(T.x-(ut.bmg.x-60))/120)),T.x>G-32&&T.y<32?(k[0]&&(Z.play(),dt=!0,ht=!ht),lt=25):lt=0,T.x<G-32&&T.x>G-64&&T.y<32?(ct=25,k[0]&&(Z.play(),dt=!dt)):ct=0}function u(t,e,n,o=0,a=1,i=1){var r=t.drawLimitSize;if(e+r>$&&e-r<Q&&n+r>V&&n-r<q||nt){let r=t.spr;0===o&&1===a&&1===i?U.drawImage(r,Math.round(e+Y.x+ot-r.width/2),Math.round(n+Y.y+at-r.height/2)):(U.setTransform(a,0,0,i,Math.round(e+Y.x+ot),Math.round(n+Y.y+at)),U.rotate(o),U.drawImage(r,Math.round(-r.width/2),Math.round(-r.height/2)),U.setTransform(1,0,0,1,0,0))}}function d(t,e,n,o=0,a=1,i=1){let r=t.spr;0===o&&1===a&&1===i?U.drawImage(r,Math.round(e+Y.x+ot-r.width/2),Math.round(n+Y.y+at-r.height/2)):(U.setTransform(a,0,0,i,Math.round(e+Y.x+ot),Math.round(n+Y.y+at)),U.rotate(o),U.drawImage(r,Math.round(-r.width/2),Math.round(-r.height/2)),U.setTransform(1,0,0,1,0,0))}function p(t,e,n,o,a){U.fillStyle=a,U.fillRect(t-n/2+Y.x+ot,e-o/2+Y.y+at,n,o)}function f(t,e,n,o){U.beginPath(),U.arc(t+Y.x+ot,e+Y.y+at,n,0,2*Math.PI,!1),U.fillStyle=o,U.fill()}function g(t,e,n,o){t+=Y.x+ot,e+=Y.y+at,U.fillStyle=o,U.beginPath(),U.moveTo(t+n[0].x,e+n[0].y);for(let o=1,a=n.length;o<a;o++)U.lineTo(t+n[o].x,e+n[o].y);U.fill()}function y(t,e,n,o="black",a=1,i=G){t=t.toString(),U.fillStyle=o,U.font=8*Math.round(a)+"px pixelmix";var r=t.split("\n");for(let t=0;t<r.length;t++)if(U.measureText(r[t]).width>i){var s=r[t].split(" "),l="",c=0;r.splice(t,1);for(let e=0;e<s.length;e++)U.measureText(l+s[e]+" ").width<i?l+=s[e]+" ":(0==e&&(l+=s[e]),r.splice(t+c,0,l),c++,l="",s.splice(0,0==e?1:e),e=-1);0!=l.length&&r.splice(t+c,0,l)}for(let t=0;t<r.length;t++)U.fillText(r[t],e+Y.x+ot,n+Y.y+at+(8*(t+(et?1:0))*a+a*t))}function m(t,e){Y.x=-t+J.cvs.width/2,Y.y=-e+J.cvs.height/2}function v(t,e){Y.x-=e*Math.sin(Y.angle),Y.y-=e*Math.cos(Y.angle),Y.x-=t*Math.sin(Y.angle+1.57079632),Y.y-=t*Math.cos(Y.angle+1.57079632)}function x(t,e,n,o,a,i){i.setTransform(o,0,0,o,t,e),i.rotate(n),i.drawImage(a,-a.width/2,-a.height/2),i.setTransform(1,0,0,1,0,0)}var w={a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,BACKTICK:192,MINUS:189,EQUALS:187,OPENSQUARE:219,ENDSQUARE:221,SEMICOLON:186,SINGLEQUOTE:222,BACKSLASH:220,COMMA:188,PERIOD:190,SLASH:191,ENTER:13,BACKSPACE:8,TAB:9,CAPSLOCK:20,SHIFT:16,CONTROL:17,ALT:18,META:91,LEFTBACKSLASH:226,ESCAPE:27,HOME:36,END:35,PAGEUP:33,PAGEDOWN:34,DELETE:46,INSERT:45,PAUSE:19,UP:38,DOWN:40,LEFT:37,RIGHT:39,CONTEXT:93,SPACE:32,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123},I=[],A=[],k=[],E=[],M=0,T={x:0,y:0},C=[!1,!0,!0];function P(){for(var t=0;t<I.length;t++)I[t]&&(I[t]=0);for(t=0;t<k.length;t++)k[t]&&(k[t]=0);M=0}function S(t){var e=t.keyCode;I[e]=I[e]==[][[]]?1:0,A[e]=1,C[0]&&t.preventDefault()}function N(t){var e=t.keyCode;delete I[e],delete A[e]}function D(t){var e=t.button;k[e]=k[e]==[][[]]?1:0,E[e]=1,C[1]&&t.preventDefault()}function j(t){var e=t.button;delete k[e],delete E[e]}function L(t){T.x=t.offsetX,T.y=t.offsetY}function O(t){C[1]&&t.preventDefault()}function H(t){M+=t.deltaY/100*-1,C[2]&&t.preventDefault()}function z(t,e){let n=e.x-t.x,o=e.y-t.y;return Math.sqrt(n*n+o*o)}function B(t,e){return t.x+t.w/2>=e.x-e.w/2&&t.x-t.w/2<=e.x+e.w/2&&t.y+t.h/2>=e.y-e.h/2&&t.y-t.h/2<=e.y+e.h/2}function R(t,e){return t.x+t.w/2>=e.x&&t.x-t.w/2<=e.x&&t.y+t.h/2>=e.y&&t.y-t.h/2<=e.y}var G,F,U,W,$,Q,V,q,K,X,Z,J={cvs:null,ctx:null,buffer1cvs:null,buffer1ctx:null,buffer2cvs:null,buffer2ctx:null},Y={zoom:1,angle:0,x:0,y:0},_=60,tt=!1,et=0,nt=!1,ot=0,at=0,it=!0,rt="ðŸ›",st=0,lt=0,ct=0,ht=!1,ut={},dt=!1,pt=[],ft=[],gt=[],yt={},mt=[],vt=[],xt={},bt=[],wt=[],It=0,At={sfx:1,bgm:1};cursor={sprite:null,alignment:1,show:!0},mouseOnCanvas=!1;const kt="qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM1234567890_-. ";var Et,Mt,Tt;function Ct(){J.cvs.width=document.body.clientWidth,J.cvs.height=(document.body.offsetHeight<window.innerHeight?window.innerHeight:document.body.offsetHeight)-1,G=J.cvs.width,F=J.cvs.height,function(){switch(Y.zoom<1&&(Y.zoom=1),et=0!=Y.angle?2:1!=Y.zoom?1:0){case 0:U=J.ctx;break;case 1:U=J.buffer1ctx;break;case 2:U=J.buffer2ctx}}(),function(){W=Math.max(J.cvs.width,J.cvs.height),K=W-Math.min(J.cvs.width,J.cvs.height);var t=W/Y.zoom,e=t+t/2;J.buffer1cvs.width=G,J.buffer1cvs.height=F,J.buffer2cvs.width=e,J.buffer2cvs.height=e,2===et?(ot=(J.buffer2cvs.width-J.cvs.width)/2,at=(J.buffer2cvs.height-J.cvs.height)/2):(ot=0,at=0),J.ctx.imageSmoothingEnabled=!1,J.buffer1ctx.imageSmoothingEnabled=!1,J.buffer2ctx.imageSmoothingEnabled=!1}(),J.ctx.clearRect(0,0,J.cvs.width,J.cvs.height),J.buffer1ctx.clearRect(0,0,J.buffer1cvs.width,J.buffer1cvs.height),J.buffer2ctx.clearRect(0,0,J.buffer2cvs.width,J.buffer2cvs.height);var t=0;2==et&&(t=J.buffer2cvs.width-W),$=-Y.x-(2==et?K:0)-t,Q=-Y.x+W+(2==et?K:0)+t,V=-Y.y-(2==et?K:0)-t,q=-Y.y+W+(2==et?K:0)+t,cn(),1===et&&x(J.cvs.width/2,J.cvs.height/2,0,Y.zoom,J.buffer1cvs,J.ctx),2===et&&(x(J.cvs.width/2,J.cvs.height/2,Y.angle,1,J.buffer2cvs,J.buffer1ctx),x(J.cvs.width/2,J.cvs.height/2,0,Y.zoom,J.buffer1cvs,J.ctx)),U=J.ctx,ot=0,at=0;var e={x:Y.x,y:Y.y},n=et;Y.x=0,Y.y=0,et=0,nt=!0;try{!function(){switch(an){case _e.TITLE:case _e.OVERWORLD:case _e.FIGHTING:case _e.LOADING:case _e.CUTSCENE:break;case _e.BUILDING:!function(){switch(se){case"pen":u(yt.buildPen,T.x+16,T.y+16,0,2,2);break;case"bucket":u(yt.buildBucket,T.x+16,T.y+16,0,2,2);break;case"pointer":u(yt.buildPointer,T.x+16,T.y+16,0,2,2)}}()}}()}catch(t){}nt=!1;let o=G/2-100,a=F/2-100;ut.sfx={x:o+125,y:a+40,w:120,h:20},ut.bmg={x:o+125,y:a+70,w:120,h:20},function(){let t={x:G-16,y:16};p(t.x,t.y,34,34,"#9c9c9c");let e=lt+45;p(t.x,t.y,32,32,`rgb(${e},${e},${e})`),e=lt+69;let n=`rgb(${e},${e},${e})`;p(t.x,t.y-6,26,4,n),p(t.x-6,t.y-6,4,8,n),p(t.x,t.y+6,26,4,n),p(t.x+11,t.y+6,4,8,n),t.x-=33,p(t.x,t.y,34,34,"#9c9c9c"),e=ct+45,p(t.x,t.y,32,32,`rgb(${e},${e},${e})`),e=ct+69,n=`rgb(${e},${e},${e})`,dt?g(t.x,t.y,[{x:-7,y:-10},{x:-7,y:10},{x:10,y:0}],n):(p(t.x+6,t.y,6,20,n),p(t.x-6,t.y,6,20,n))}(),function(){if(ht){let t={x:G/2-100,y:F/2-100};p(G/2,F/2,200,200,"#242424"),y("sfx",t.x+2,t.y+30,"white",2),b=ut.sfx,p(b.x,b.y,b.w,b.h-10,"#444444"),p(b.x-60+120*At.sfx,b.y,8,20,"#444444"),y("bmg",t.x+2,t.y+60,"white",2),b=ut.bmg,p(b.x,b.y,b.w,b.h-10,"#444444"),p(b.x-60+120*At.bgm,b.y,8,20,"#444444")}}(),cursor.sprite&&mouseOnCanvas?(cursor.alignment?J.ctx.drawImage(cursor.sprite.spr,T.x-Math.round(cursor.sprite.spr.width/2),T.y-Math.round(cursor.sprite.spr.height/2)):J.ctx.drawImage(cursor.sprite.spr,T.x,T.y),cursor.show=!1):cursor.show=!0,et=n,Y.x=e.x,Y.y=e.y,requestAnimationFrame(Ct)}function Pt(){0==it&&h(),Mt.gain.value=At.sfx,Tt.gain.value=At.bgm,dt||ln(),0==it&&P()}function St(){h(),dt||input(),P()}function Nt(t){return 16*Math.round(t/16)}function Dt(t,e,n){return Math.min(n,Math.max(e,t))}AudioContext=window.AudioContext||window.webkitAudioContext,t("game").onmouseout=function(){mouseOnCanvas=!1},t("game").onmouseover=function(){mouseOnCanvas=!0};const jt=2*Math.PI,Lt=Math.PI,Ot=Lt/2;function Ht(t,e,n){return e<0&&(e=jt+e),t%jt>e?t%jt-e>Lt?t+=n:t-=n:e-t%jt>Lt?t-=n:t+=n,Math.abs(t-e)<1.1*n&&(t=e),t>jt&&(t-=jt),t<0&&(t=jt+t),t}var zt,Bt=0,Rt=0,Gt=[{update:()=>{Vt.y+=Math.cos(Vt.angle)/4,Vt.x+=Math.sin(Vt.angle)/4,Bt>20&&(ne(zt),hn(_e.OVERWORLD))},draw:()=>{var t,e,n,o,a;p(8*Zt,8*Jt,16*Zt,16*Jt,`rgba(0,0,0,${t=Bt,e=0,n=20,o=0,a=1,o+(a-o)*(t-e)/(n-e)})`)}}];class Ft{constructor(t,e,n,o){this.x=t,this.y=e,this.w=n,this.h=o}get colliding(){for(var t=this.collisions,e=0,n=t.length;e<n;e++)if(B(this,t[e]))return!0;return!1}get collisions(){for(var t=[...qt,Vt,...Wt],e=0,n=t.length;e<n;e++)if(t[e].x===this.x&&t[e].y===this.y){t.splice(e,1);break}return t}}class Ut extends Ft{constructor(){super(0,0,14,14),this.angle=0,this.vel=0,this.walkCycle=1}}Ut.prototype.update=function(){var t,e,n=!1,o=0,a=0;A[w.w]&&(this.vel+=.05,o-=Math.PI*(A[w.d]?-1:1),n=!0,a++),A[w.s]&&(this.vel+=.05,n=!0,a++),A[w.a]&&(this.vel+=.05,n=!0,o-=Math.PI/2,a++),A[w.d]&&(this.vel+=.05,n=!0,o+=Math.PI/2,a++),o/=a=0===a?1:a,n&&(this.angle=Ht(this.angle,o,.15)),this.vel=Dt(this.vel,0,1),n||(this.vel=(t=this.vel,e=.3,t>0&&(t-=e),t<0&&(t+=e),Math.abs(t)<2*e&&(t=0),t));var i=this.collisions;this.x+=Math.sin(this.angle)*this.vel;for(var r=0,s=i.length;r<s;r++)B(this,i[r])&&(this.x-=Math.sin(this.angle)*this.vel);this.y+=Math.cos(this.angle)*this.vel;for(r=0,s=i.length;r<s;r++)B(this,i[r])&&(this.y-=Math.cos(this.angle)*this.vel);this.walkCycle+=Math.abs(this.vel/5),0==this.vel&&(this.walkCycle=3),this.walkCycle>=11&&(this.walkCycle=1),this.moveCamera()},Ut.prototype.moveCamera=function(){Y.zoom=3;var t={x:this.x,y:this.y},e=Yt[0].length,n=Yt.length;48*n<F?t.y=8*Yt.length:(t.y<F/2/Y.zoom&&(t.y=F/2/Y.zoom),t.y>16*n-F/2/Y.zoom&&(t.y=16*n-F/2/Y.zoom)),48*e<G?t.x=8*Yt[0].length:(t.x<G/2/Y.zoom&&(t.x=G/2/Y.zoom),t.x>16*e-G/2/Y.zoom&&(t.x=16*e-G/2/Y.zoom)),m(t.x,t.y)},Ut.prototype.draw=function(){var t=Math.floor(this.walkCycle);u(yt["player"+(t=t>5?11-t:t)],this.x,this.y,-this.angle+Ot)};var Wt=[];const $t=0;class Qt extends Ft{constructor(t,e,n,o,a=0){super(t,e,n,o),this.angle=a,this.agroed=!1,this.velocity={x:Math.cos(a),y:Math.sin(a)},this.drawScale=1,this.updateCount=0}}Qt.prototype.movementType=$t,Qt.prototype.baseHP=10,Qt.prototype.agroRadius=200,Qt.prototype.update=function(){if(this.agroed){var t=0,e=0,n=this.collisions;switch(this.movementType){case $t:var o=this.updateCount%50;this.drawScale=1,o<25?(t=this.velocity.x*(o<18?1:.5),e+=this.velocity.y*(o<18?1:.5),this.drawScale=1+Math.sin(o/7.65)/2):(this.angle=Ht(this.angle,r(this,Vt),.05),this.velocity={x:Math.cos(this.angle),y:Math.sin(this.angle)})}this.x+=t;for(var a=0,i=n.length;a<i;a++)if(B(this,n[a])){this.x-=t,"Object"!==n[a].__proto__.constructor.name&&(n[a].x+=t/2);break}this.y+=e;for(a=0,i=n.length;a<i;a++)if(B(this,n[a])){this.y-=e,"Object"!==n[a].__proto__.constructor.name&&(n[a].y+=e/2);break}}else z(this,Vt)<this.agroRadius&&(this.agroed=!0);this.updateCount++},Qt.prototype.draw=function(){u(yt.debug0,this.x,this.y,this.angle,this.drawScale,this.drawScale)};var Vt=new Ut,qt=[];function Kt(t){if(t&&(Vt.x=50,Vt.y=100),I[w.BACKSLASH]&&(rn=_e.BUILDING,an=_e.LOADING,Ye=!1),!sn){for(var e=0,n=_t.length;e<n;e++)_t[e].update();Vt.update(),function(){for(var t=0,e=Wt.length;t<e;t++)Wt[t].update()}()}}function Xt(){var t=8*Yt[0].length,e=8*Yt.length;d({spr:te.ground,drawLimitSize:0},t,e),Vt.draw(),function(){for(var t=0,e=Wt.length;t<e;t++)Wt[t].draw()}(),d({spr:te.walls,drawLimitSize:0},t,e),d({spr:te.objects,drawLimitSize:0},t,e)}var Zt,Jt,Yt=[],_t=[],te={ground:null,walls:null,objects:null};function ee(){var e={};e.name=t("name").value,e.w=Yt[0].length,e.h=Yt.length;for(var n="",o=0;o<Jt;o++)for(var a=0;a<Zt;a++)n+=Yt[o][a].data+",";n=n.substring(0,n.length-1),e.tiles=n;for(var i="",r=0,s=_t.length;r<s;r++)i+=_t[r].data+",";return i=i.substring(0,i.length-1),e.objects=i,e}function ne(t){fetch(Me+Ee[t]).then(t=>t.json().then(t=>{oe(t),Te(),ae()}))}function oe(e){t("name").value=e.name;var n=e.w;t("roomW").value=e.w,Zt=n;var o=e.h;t("roomH").value=e.h,Jt=o,Yt=[];for(var a=e.tiles.split(","),i=0;i<o;i++){for(var r=[],s=0;s<n;s++){var l=(d=a[s+i*n].split(".")).length;r.push(new(Ne[Se[parseInt(d[0])]])(s,i,parseInt(d[0]),l>1?parseInt(d[1]):0,l>2?parseInt(d[2]):0))}Yt.push(r)}_t=[];var c=e.objects.split(",");if(c.length>0&&c[0].length>0)for(var h=0,u=c.length;h<u;h++){var d=c[h].split("~");_t.push(new(Qe[$e[parseInt(d[2])]])(parseInt(d[0])+.5,parseInt(d[1])+.5,parseInt(d[2]),parseInt(d[3]),parseInt(d[4]),d[5]))}}function ae(){qt=[];for(var t=[],e=[],n=0;n<Jt;n++){for(var o=[],a=[],i=0;i<Zt;i++)o.push(Yt[n][i].layer===Oe.wall),a.push(!1);t.push(o),e.push(a)}for(n=0;n<Jt;n++)for(i=0;i<Zt;i++)if(!e[n][i]&&t[n][i]){for(var r=i;r<Zt&&t[n][r];)r++;r--;for(var s=n,l=!0;s<Jt&&t[s][r]&&l;){s++;for(var c=r;c>-1&&t[s][c];)c--;c+1!==i&&(l=!1,s--)}for(var h=n;h<s+1;h++)for(var u=i;u<r+1;u++)e[h][u]=!0;var d=(i+r+1)/2,p=(n+s+1)/2,f=r-i+1,g=s-n+1;qt.push({x:16*d,y:16*p,w:16*f,h:16*g})}}var ie=!1,re={type:"tile",ID:0,variance:0,rotation:0,menuPos:{x:0,y:1},objectIndex:-1},se="pen",le={x:0,y:0},ce=!1,he={states:[],pos:-1,lastStep:"forward",lastActionWasEdit:!1,bufferSize:200};function ue(n){if(n&&(J.cvs.style.cursor="none",ie||(!function(){for(var n=0,o=e("tr"),a=0;a<Se.length;a++){(i=e("button")).id="t"+a,i.xPos=n,i.yPos=t("buildTable").childNodes.length,i.onclick=function(){re.menuPos.x=this.xPos,re.menuPos.y=this.yPos,me(parseInt(this.id[1]))},o.appendChild(ke(i,yt[Ne[Se[a]].prototype.imageName+"0"].spr.src,Ne[Se[a]].prototype.layer?"#320738":"#08403a")),10===++n&&(t("buildTable").appendChild(o),o=e("tr"),n=0)}for(a=0;a<$e.length;a++){var i;(i=e("button")).id="o"+a,i.xPos=n,i.yPos=t("buildTable").childNodes.length,i.onclick=function(){re.menuPos.x=this.xPos,re.menuPos.y=this.yPos,ve(parseInt(this.id[1]))},o.appendChild(ke(i,yt[Qe[$e[a]].prototype.imageName+"0"].spr.src,"#265917")),10===++n&&(t("buildTable").appendChild(o),o=e("tr"),n=0)}t("buildTable").appendChild(o),t("build").style.visibility="visible"}(),ie=!0),t("build").style.display="block",t("hideShow").style.display="block",t("object").style.display="block",pe()),I[w.BACKSLASH]&&(J.cvs.style.cursor="crosshair",t("build").style.display="none",t("hideShow").style.display="none",t("object").style.display="none",hn(_e.OVERWORLD),Te(),ae()),-1===re.objectIndex)we.innerHTML="";else if(Je%10==0)for(var o=Object.keys((new Qe[$e[_t[re.objectIndex].objectID]]).metaArguments).length,i=0;i<o;i++){var r=t("objectMeta"+i);_t[re.objectIndex].meta[r.labelName]="number"===r.type?parseInt(r.value):r.value}ce=t("randAngle").checked;var s=t("tableSelection").style;s.top=43*re.menuPos.y-2+"px",s.left=42*re.menuPos.x+"px",I[w.UP]&&fe(0,-1)&&(re.menuPos.y--,ye()),I[w.DOWN]&&fe(0,1)&&(re.menuPos.y++,ye()),I[w.LEFT]&&fe(-1,0)&&(re.menuPos.x--,ye()),I[w.RIGHT]&&fe(1,0)&&(re.menuPos.x++,ye());var l=t("buildVariations").children[0];if(void 0!==l){i=1;for(var c=l.children.length;i<10&&i<=c;i++)I[w[i+""]]&&l.children[i-1].children[0].onclick()}if((k[0]||I[w.ESCAPE])&&([].forEach.call(document.getElementsByTagName("button"),t=>{t.blur()}),[].forEach.call(document.getElementsByTagName("select"),t=>{t.blur()}),[].forEach.call(document.getElementsByTagName("input"),t=>{t.blur()})),A[w.a]&&v(-10/Y.zoom,0),A[w.d]&&v(10/Y.zoom,0),A[w.w]&&v(0,-10/Y.zoom),A[w.s]&&v(0,10/Y.zoom),M&&(!(M<0)||Y.zoom>1)){var h=1;M<0&&(h=-1);var u=1-Y.zoom/(Y.zoom+h),d=a();Y.x-=(T.x-G/2)*u,Y.y-=(T.y-F/2)*u,Y.zoom+=h}if(I[w.q]&&--re.rotation<0&&(re.rotation=3),I[w.e]&&++re.rotation>3&&(re.rotation=0),I[w.x]&&(se="pen"),I[w.c]&&(se="bucket"),(I[w.v]||I[w.ESCAPE])&&(se="pointer"),(I[w.BACKSPACE]||I[w.DELETE]&&re.objectIndex>-1)&&(_t.splice(re.objectIndex,1),re.objectIndex--,Ie()),Yt.length>0){switch(I[w.SHIFT]&&m(8*(Zt-1),8*(Jt-1)),(d=a()).x=Dt(Nt(d.x)/16,0,Zt-1),d.y=Dt(Nt(d.y)/16,0,Jt-1),k[0]&&pe(),I[w.z]&&he.pos>-1&&(he.lastActionWasEdit?he.states.push(JSON.stringify(ee())):"forward"===he.lastStep&&he.pos--,oe(JSON.parse(he.states[he.pos])),he.pos--,he.lastStep="back",he.lastActionWasEdit=!1,re.objectIndex=_t.length-1,Ie()),I[w.y]&&he.pos<he.states.length-1&&("back"===he.lastStep&&he.pos++,he.pos++,oe(JSON.parse(he.states[he.pos])),he.lastStep="forward",he.lastActionWasEdit=!1,re.objectIndex=_t.length-1,Ie()),se){case"pen":if(E[0]&&(le.x!==d.x||le.y!==d.y)||k[0]){if(z(d,le)>1)for(var p=Math.min(le.x,d.x),f=Math.max(le.x,d.x),g=Math.min(le.y,d.y),y=Math.max(le.y,d.y),x=g;x<=y;x++)for(var b=p;b<=f;b++)ge(b,x,le.x,le.y,d.x,d.y)<=.5&&de(b,x);de(d.x,d.y)}break;case"bucket":if(k[0]){var C=Zt,P=Jt,S=t("fillType").value,N=Yt[d.y][d.x].data,D=`${re.ID}.${re.variance}.${re.rotation}`;if("id"===S&&(N=N.split(".")[0]),N!==D){var j=[];j.push([d.x,d.y]);var L=[],O=[];for(x=0;x<P;x++){var H=[],B=[];for(b=0;b<C;b++)H.push(!1),"id"===S?B.push(Yt[x][b].data.split(".")[0]):B.push(Yt[x][b].data);L.push(H),O.push(B)}for(C--,P--;j.length>0;){var U=j.pop();L[U[1]][U[0]]||(O[U[1]][U[0]]=D,de(U[0],U[1]),L[U[1]][U[0]]=!0,U[1]<P&&O[U[1]+1][U[0]]===N&&j.push([U[0],U[1]+1]),U[0]<C&&O[U[1]][U[0]+1]===N&&j.push([U[0]+1,U[1]]),U[1]>0&&O[U[1]-1][U[0]]===N&&j.push([U[0],U[1]-1]),U[0]>0&&O[U[1]][U[0]-1]===N&&j.push([U[0]-1,U[1]]))}}}break;case"pointer":if(k[0]){var W=a();W.x+=8,W.y+=8;for(i=0,c=_t.length;i<c;i++)R(_t[i],W)&&(re.objectIndex=i,Ie())}}if(k[2]){var $=Yt[d.y][d.x];re.type="tile",me($.tileID),re.rotation=Math.round($.rotation/Math.PI*2),re.variance=$.variation}le=d}}function de(t,e){var n=re.rotation;switch(ce&&(n=i(0,3)),re.type){case"tile":Yt[e][t]=new Ne[Se[re.ID]](t,e,re.ID,re.variance,n);break;case"object":re.objectIndex=_t.length,_t.push(new Qe[$e[re.ID]](t+.5,e+.5,re.ID,re.variance,n)),Ie()}}function pe(){he.pos<he.states.length-1&&(he.states.length=he.pos+1),he.states.push(JSON.stringify(ee())),he.pos++,he.lastStep="forward",he.lastActionWasEdit=!0,he.states.length>he.bufferSize&&(he.states.shift(),he.pos--)}function fe(e,n){if(re.menuPos.y+n===0)return!1;var o=t("buildTable").children[re.menuPos.y+n];return void 0!==o&&void 0!==o.children[re.menuPos.x+e]}function ge(t,e,n,o,a,i){var r,s,l=a-n,c=i-o,h=l*l+c*c,u=-1;0!=h&&(u=((t-n)*l+(e-o)*c)/h),u<0?(r=n,s=o):u>1?(r=a,s=i):(r=n+u*l,s=o+u*c);var d=t-r,p=e-s;return Math.sqrt(d*d+p*p)}function ye(){t("buildTable").children[re.menuPos.y].children[re.menuPos.x].children[0].onclick()}function me(n){re.type="tile",re.ID=n,re.variance=0,re.rotation=0,re.menuPos.x=n%10,re.menuPos.y=Math.floor(n/10)+1;for(var o=e("tr"),a=Ne[Se[n]],i=0,r=a.prototype.typesAmount;i<r;i++){var s=e("button");s.id="v"+i,s.style="width: 34px; height: 34px; padding:0;",s.onclick=function(){re.variance=parseInt(this.id[1])},o.appendChild(ke(s,yt[a.prototype.imageName+i].spr.src))}t("buildVariations").innerHTML="",t("buildVariations").appendChild(o);for(var l=Se[n],c=`id: ${n}\n type: tile\n layer: ${a.prototype.layer}\n name: ${l}\n merges with: `,h=a.prototype.mergesWith,u=0;u<h.length;u++)c+=Se[h[u]]+", ";t("buildInfo").innerText=c}function ve(n){re.type="object",re.ID=n,re.variance=0,re.rotation=0;for(var o=e("tr"),a=Qe[$e[n]],i=0,r=a.prototype.typesAmount;i<r;i++){var s=e("button");s.id="v"+i,s.style="width: 34px; height: 34px; padding:0;",s.onclick=function(){re.variance=parseInt(this.id[1])},o.appendChild(ke(s,yt[a.prototype.imageName+i].spr.src))}t("buildVariations").innerHTML="",t("buildVariations").appendChild(o);for(var l=`id: ${n}\n type: object\n name: ${$e[n]}\n arguments: `,c=Object.keys(a.prototype.metaArguments),h=0;h<c.length;h++)l+=c[h]+", ";t("buildInfo").innerText=l}t("selectPen").onclick=function(){se="pen"},t("selectBucket").onclick=function(){se="bucket"},t("selectPointer").onclick=function(){se="pointer"},t("hideShow").onclick=function(){"hide"===this.innerText?(t("build").style.display="none",this.innerText="show",this.style.left="10px"):(t("build").style.display="block",this.innerText="hide",this.style.left="475px")},t("newRoom").onclick=function(){0!==Yt.length&&pe(),Yt=[],_t=[];for(var e=parseInt(t("roomW").value),n=parseInt(t("roomH").value),o=0;o<n;o++){for(var a=[],i=0;i<e;i++)a.push(new Ge(i,o,0,0,0));Yt.push(a)}re.objectIndex=-1,m(8*e,8*n)},t("help").onclick=function(){var e=t("helpDiv").style;e.display="block"===e.display?"none":"block"};var xe,be,we=t("object");function Ie(){if(-1!==re.objectIndex){we.innerHTML="";for(var t=(new Qe[$e[_t[re.objectIndex].objectID]]).metaArguments,e=Object.keys(t),n=0;n<e.length;n++)Ae(e[n],t[e[n]],n)}}function Ae(t,n,o){var a=e("span");switch(a.innerText=t,a.style.paddingRight="20px",we.appendChild(a),n){case Ve.string:(i=e("input")).type="text",i.id="objectMeta"+o,i.labelName=t,we.appendChild(i);break;case Ve.number:var i;(i=e("input")).type="number",i.id="objectMeta"+o,i.labelName=t,we.appendChild(i);break;case Ve.room:(r=e("select")).innerHTML=xe.innerHTML,r.id="objectMeta"+o,r.labelName=t,we.appendChild(r);break;case Ve.enemy:var r;(r=e("select")).innerHTML=be.innerHTML,r.id="objectMeta"+o,r.labelName=t,we.appendChild(r)}var s=e("br");we.appendChild(s)}function ke(t,n,o="#00000000"){var a=e("td");a.style.backgroundColor=o,t.style="width: 34px; height: 34px; padding:0;";var i=e("img");return i.style.width="32px",i.style.height="32px",i.src=n,t.appendChild(i),a.appendChild(t),a}t("save").onclick=function(){var n=ee(),o=e("a");o.download=t("name").value;var a=new Blob([JSON.stringify(n)],{type:"application/json"});o.href=URL.createObjectURL(a);var i=document.createEvent("MouseEvents");i.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),o.dispatchEvent(i)},t("fileUpload").onchange=function(){void 0!==t("fileUpload").files[0]&&(0!==Yt.length&&pe(),fetch(URL.createObjectURL(t("fileUpload").files[0])).then(t=>t.json().then(t=>{oe(t),re.objectIndex=-1,Ie(),m(0,0)})))};var Ee=["test.json","a.json","village.json"],Me="assets/rooms/";function Te(){Y.x=0,Y.y=0,Y.angle=0,Y.zoom=1,ot=8,at=8,nt=!0;for(var t=[[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1],[0,-1]],n=Object.keys(te),o=0;o<n.length;o++)te[n[o]]=e("canvas"),te[n[o]].width=16*Zt,te[n[o]].height=16*Jt;var a=te.ground.getContext("2d");U=a;for(var i=0;i<Jt;i++)for(var r=0;r<Zt;r++)Yt[i][r].layer===Oe.ground&&Yt[i][r].draw();var s=a.getImageData(0,0,16*Zt,16*Jt);for(i=0;i<Jt;i++)for(r=0;r<Zt;r++){var l=Yt[i][r].mergesWith;i+1<Jt&&l.includes(Yt[i+1][r].tileID)&&Ce(s,Yt[i][r],16*r,16*(i+1),"bottom"),i-1>-1&&l.includes(Yt[i-1][r].tileID)&&Ce(s,Yt[i][r],16*r,16*(i-1),"top"),r+1<Zt&&l.includes(Yt[i][r+1].tileID)&&Ce(s,Yt[i][r],16*(r+1),16*i,"right"),r-1>-1&&l.includes(Yt[i][r-1].tileID)&&Ce(s,Yt[i][r],16*(r-1),16*i,"left")}a.putImageData(s,0,0);var c=te.walls.getContext("2d");U=c;for(i=0;i<Jt;i++)for(r=0;r<Zt;r++)Yt[i][r].layer===Oe.wall&&Yt[i][r].draw();function h(t,e){return t<Zt&&t>-1&&e<Jt&&e>-1}for(i=0;i<Jt;i++)for(r=0;r<Zt;r++)if(Yt[i][r].layer===Oe.wall){var d="";for(o=0;o<8;o++){var p=t[o];h(r+p[0],i+p[1])?d+=Yt[i+p[1]][r+p[0]].layer===Oe.wall?"1":"0":d+="1"}u({spr:Pe[d],drawLimitSize:8},16*r,16*i)}ot=0,at=0;var f=te.objects.getContext("2d");U=f;o=0;for(var g=_t.length;o<g;o++)_t[o].draw();Ye=!1}function Ce(t,e,n,o,a){var r=4*t.width,s=4*n,l=o*r,c=t.data,h=He[e.tileID][e.variation].data;function u(t,e){worldPosition=e*r+l+4*t+s,tilePosition=64*e+4*t,c[worldPosition]=h[tilePosition],c[worldPosition+1]=h[tilePosition+1],c[worldPosition+2]=h[tilePosition+2],c[worldPosition+3]=h[tilePosition+3]}switch(a){case"top":for(var d=15;d>9;d--)for(var p=0;p<16;p++)0===i(0,(16-d)/2)&&u(p,d);break;case"bottom":for(d=0;d<6;d++)for(p=0;p<16;p++)0===i(0,d/2)&&u(p,d);break;case"right":for(d=0;d<16;d++)for(p=0;p<6;p++)0===i(0,p/2)&&u(p,d);break;case"left":for(d=0;d<16;d++)for(p=15;p>9;p--)0===i(0,(16-p)/2)&&u(p,d)}}var Pe={};var Se=["TileGrass","TilePath","TileBrickPath","WallBrick","WallHouse"],Ne={};const De=0,je=1,Le=2,Oe={ground:0,wall:1};var He=[];class ze{constructor(t,e,n,o,a=0){this.x=16*t,this.y=16*e,this.tileID=n,this.variation=o,this.rotation=a*Math.PI/2}get data(){return 0!==this.rotation?`${this.tileID}.${this.variation}.${~~(this.rotation/Ot)}`:0!==this.variation?`${this.tileID}.${this.variation}`:""+this.tileID}}ze.prototype.w=16,ze.prototype.h=16,ze.prototype.imageName="debug",ze.prototype.typesAmount=1,ze.prototype.mergesWith=[],ze.prototype.effect=De,ze.prototype.layer=Oe.ground,ze.prototype.draw=function(){u(yt[`${this.imageName}${this.variation}`],this.x,this.y,this.rotation)},Ne.Tile=ze;class Be extends ze{constructor(t,e,n,o,a=0){super(t,e,n,o,a)}}Be.prototype.effect=je,Be.prototype.layer=Oe.wall,Ne.BaseWall=Be;class Re extends ze{constructor(t,e,n,o,a=0){super(t,e,n,o,a)}}Re.prototype.imageName="brickPath",Re.prototype.typesAmount=3,Re.prototype.effect=Le,Ne.TileBrickPath=Re;class Ge extends ze{constructor(t,e,n,o,a=0){super(t,e,n,o,a)}}Ge.prototype.imageName="grass",Ge.prototype.typesAmount=2,Ge.prototype.mergesWith=[0,1,3],Ne.TileGrass=Ge;class Fe extends ze{constructor(t,e,n,o,a=0){super(t,e,n,o,a)}}Fe.prototype.imageName="path",Fe.prototype.effect=Le,Fe.prototype.mergesWith=[3],Ne.TilePath=Fe;class Ue extends Be{constructor(t,e,n,o,a=0){super(t,e,n,o,a)}}Ue.prototype.imageName="brick",Ue.prototype.typesAmount=4,Ne.WallBrick=Ue;class We extends Be{constructor(t,e,n,o,a=0){super(t,e,n,o,a)}}We.prototype.imageName="house",We.prototype.typesAmount=3,Ne.WallHouse=We;var $e=["HouseEntrance","HouseSmokeStack"],Qe={},Ve={number:0,string:1,enemy:2,room:3};class qe{constructor(t,e,n,o,a=0,i=""){this.x=16*t,this.y=16*e,this.objectID=n,this.variation=o,this.rotation=a*Math.PI/2,this.meta={};for(var r=i.split("@"),s=0;s<this.metaArguments.length;s++){var l=r[s].length;l>0&&(parseInt(r[s]).toString().length===l?this.meta[this.metaArguments[s][0]]=parseInt(r[s]):this.meta[this.metaArguments[s][0]]=r[s])}}get data(){for(var t="",e=0;e<this.metaArguments.length;e++)t+=this.meta[this.metaArguments[e][0]]+"@";return t=t.substring(0,t.length-1),`${this.x/16-.5}~${this.y/16-.5}~${this.objectID}~${this.variation}~${~~(this.rotation/Ot)}~${t}`}}qe.prototype.imageName="debug",qe.prototype.typesAmount=1,qe.prototype.metaArguments=[],qe.prototype.w=16,qe.prototype.h=16,qe.prototype.draw=function(){u(yt[`${this.imageName}${this.variation}`],this.x,this.y,this.rotation)},qe.prototype.update=function(){return!1},qe.prototype.initialize=function(){},Qe.BaseObject=qe;class Ke extends qe{constructor(t,e,n,o,a=0,i={}){super(t,e,n,o,a,i)}}Ke.prototype.imageName="houseEntrance",Ke.prototype.metaArguments=[["room",Ve.room]],Ke.prototype.update=function(){return z(this,Vt)<20&&(Vt.angle=-r(Vt,this)+Ot,zt=this.meta.room,Rt=0,an=_e.CUTSCENE),!1},Qe.HouseEntrance=Ke;class Xe extends qe{constructor(t,e,n,o,a=0,i={}){super(t,e,n,o,a,i)}}Xe.prototype.imageName="smokeStack",Xe.prototype.update=function(){return!1},Qe.HouseSmokeStack=Xe,pt=["assets/images/",["tiles/","debug0.png","grass0.png","grass1.png","path0.png","brick0.png","brick1.png","brick2.png","brick3.png","brickPath0.png","brickPath1.png","brickPath2.png","house0.png","house1.png","house2.png"],["objects/","tree0.png","tree1.png","link0.png","link1.png","houseEntrance0.png","smokeStack0.png"],["UI/slot","Accessory.png","Weapon.png","Select.png","Frame.png","Head.png","Body.png","Pants.png","Boots.png","Hand.png"],["entities/",["player","1.png","2.png","3.png","4.png","5.png"]],"preview0.png","tempPlayer.png","tempEnemy00.png","buildPen.png","buildBucket.png","buildPointer.png","shadowSide.png","shadowCorner.png"],mt=["assets/audio/"];var Ze=0,Je=0,Ye=!0;const _e={TITLE:0,LOADING:1,OVERWORLD:2,FIGHTING:3,CUTSCENE:4,BUILDING:5};var tn,en,nn,on,an=_e.LOADING,rn=_e.OVERWORLD,sn=!1;function ln(){switch(en=an!=tn,tn=an,an){case _e.TITLE:break;case _e.OVERWORLD:Kt(en);break;case _e.FIGHTING:break;case _e.LOADING:en&&(t("load").style.display="block"),Ye||(t("load").style.display="none",an=rn);break;case _e.CUTSCENE:en&&(Bt=0),Gt[Rt].update(),Bt++;break;case _e.BUILDING:ue(en)}Je++}function cn(){switch(an){case _e.TITLE:break;case _e.OVERWORLD:Xt();break;case _e.FIGHTING:case _e.LOADING:break;case _e.CUTSCENE:Xt(),Gt[Rt].draw();break;case _e.BUILDING:!function(){for(var t=0;t<Jt;t++)for(var e=0;e<Zt;e++)Yt[t][e].draw();ot=-8,at=-8;for(var n=0,o=_t.length;n<o;n++)_t[n].draw();if(ot=0,at=0,Yt.length>0)if("pointer"===se){if(re.objectIndex>-1){var a=_t[re.objectIndex];new Qe[$e[a.objectID]](a.x/16-.5,a.y/16-.5,a.objectID,a.variation,-a.rotation+Math.cos(Ze/10)/5).draw()}}else"tile"===re.type?new Ne[Se[re.ID]](le.x+Math.cos(Ze/10)/10,le.y+Math.sin(Ze/10)/10,re.ID,re.variance,re.rotation).draw():new Qe[$e[re.ID]](le.x+Math.cos(Ze/10)/10,le.y+Math.sin(Ze/10)/10,re.ID,re.variance,re.rotation).draw()}()}Ze++}function hn(t){rn=t,Ye=!0,an=_e.LOADING}_=60,J.cvs=t("game"),J.cvs.width=document.body.clientWidth,J.cvs.height=document.body.offsetHeight<window.innerHeight?window.innerHeight:document.body.offsetHeight,G=J.cvs.width,F=J.cvs.height,J.ctx=J.cvs.getContext("2d",{alpha:!1}),J.cvs.onmousedown=function(){tt||(function(){var t="";function e(n,o){let a="";for(let i=0;i<n.length;i++){if("string"==typeof n[i])if(0==i)t+=n[i],a=n[i];else if("image"==o){let e=t+n[i];ft.push(e);let o=new Image;o.src=e,o.onerror=function(){console.warn(rt+" "+this.src+" was not found")},o.onload=function(){l(e,o)},gt.push(o)}else"sound"==o&&(vt.push(t+n[i]),c(t+n[i]));"object"==typeof n[i]&&e(n[i],o)}t=t.slice(0,t.length-a.length)}Et=new AudioContext,(Mt=Et.createGain()).connect(Et.destination),(Tt=Et.createGain()).connect(Et.destination),e(pt,"image"),e(mt,"sound"),(X=new Image).src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAC4jAAAuIwF4pT92AAAAf0lEQVQ4jc2SuxHAIAxDbY4pMpHmyJSeKGuQKpyj2Hy6qETPQvhQCWRmDRfeZ4cJAGW28mAUyL4Pqmx2nfK+zaR59glRHo5qZi0BaPHmbDhiyuzdsza9wcrtEVtG4Ip+FLCzTM+WneWxPv9gpQUzmhncLPOHUCYfHr4/C4r2dQPfhkeIbjeYWgAAAABJRU5ErkJggg==",Z=new Audio("data:audio/x-wav;base64,UklGRowBAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YWgBAADa/6T/2/+S/x//pP769Xr4fPh5+H34evh7+Pv6gf18/QIAhQcIDxUZFR4VHhgeEx6TFgkPCgqAAnz49/X18HLu7ubo4eXc5dzj3Gjf5+Fr5G7pce759YECiwwRFBQZlxuXG5cbFRmTFo8RCAoAAPz69/X08G7udO5s7vz1dvj++nv9gP3+/wEAgwKBAogHkBEpLUNG1lzqcPV683r4eu51ZmnVV7w+qypy88fDoKAXlAqKBoUAgIeHlpYsrTu87Ot9/ZIRGxkoKDEtqionIxgZiwfj5lnaz9JN0E3QV9pd3+Tm9fUBAAQFBwWNDBEPFxSYFpsWEA9+/fP1dfNt83bz8fX9+gQFkAwPDxQPEQ+IBwIAdfjv8OLm2+HX3Nrh4+bm63n4BAUUDx0ZqyCrJSkelBGEAnb4a+5a5Njcztxc31jkZunx9QgFGhQfGa0gqCCuIKkgpRsaFIsHdfhj6dfh0NzM19Th6es=");let n=G/2-100,o=F/2-100;ut.screenSize={x:n+160,y:o+12,w:50,h:20},ut.sfx={x:n+125,y:o+40,w:120,h:20},ut.bmg={x:n+125,y:o+70,w:120,h:20},s()}(),tt=!0)},n("buffer1"),n("buffer2"),J.ctx.imageSmoothingEnabled=!1,J.buffer1ctx.imageSmoothingEnabled=!1,J.buffer2ctx.imageSmoothingEnabled=!1,W=Math.max(J.cvs.width,J.cvs.height),K=W-Math.min(J.cvs.width,J.cvs.height),G=J.cvs.width,F=J.cvs.height,(nn=e("style")).innerHTML='\n    @font-face {\n        font-family: "pixelmix";\n        src: url(assets/pixelmix.ttf) format("truetype");\n        font-weight: 900;\n        font-style: normal;\n    }\n    html {font-family: "pixelmix" !important; font-size: 16px;}\n    ',document.head.appendChild(nn),J.ctx.textBaseline="hanging",J.ctx.textAlign="left",function(){var t=e("style");t.id="gamejsstyle",document.head.appendChild(t);var n=e("meta");n.setAttribute("charset","utf-8"),document.head.appendChild(n)}(),on=J.cvs,window.addEventListener("keydown",S),window.addEventListener("keyup",N),on.addEventListener("mousedown",D),on.addEventListener("mouseup",j),on.addEventListener("mousemove",L),on.addEventListener("contextmenu",O),on.addEventListener("wheel",H),U=J.ctx,requestAnimationFrame((function t(){J.cvs.width=document.body.clientWidth,J.cvs.height=(document.body.offsetHeight<window.innerHeight?window.innerHeight:document.body.offsetHeight)-1,G=J.cvs.width,F=J.cvs.height,U.fillStyle="#101010",U.fillRect(0,0,G,F),f(G/2,F/2,27,"#066312"),f(G/2,F/2,23,"#149124"),g(G/2,F/2,[{x:-7,y:-15},{x:-7,y:15},{x:15,y:0}],"#47f55d"),tt||requestAnimationFrame(t)}))