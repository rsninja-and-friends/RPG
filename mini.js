function t(t){return document.getElementById(t)}function e(t){return document.createElement(t)}function n(n){var i=e("canvas");i.id=n,i.width=Y.cvs.width,i.height=Y.cvs.height,i.style="image-rendering:pixelated;image-rendering: crisp-edges;display:none",document.body.appendChild(i),Y[n+"cvs"]=t(n),Y[n+"ctx"]=Y[n+"cvs"].getContext("2d")}function i(){try{input}catch(t){st=!1}(function(){De=e("select");for(var n=0;n<Re.length;n++){var i=e("option"),o=Re[n].lastIndexOf("/");i.innerText=-1===o?Re[n]:Re[n].substring(o+1),i.value=n,De.appendChild(i)}var a=e("table"),s=e("tr"),r=0;for(n=0;n<qt.length;n++){var h=e("button");h.id="e"+n,h.xPos=r,h.yPos=a.childNodes.length,h.onclick=function(){je.value=this.id.slice(1)},s.appendChild(Be(h,mt[Kt[qt[n]].prototype.imageName+"0"].spr.src,"#2e2e2e")),10==++r&&(a.appendChild.appendChild(s),s=e("tr"),r=0)}a.appendChild(s),t("enemyTable").appendChild(a);for(var l=Object.keys(ue),c=(n=0,l.length);n<c;n++)(i=e("option")).innerText=l[n],i.value=ue[l[n]],t("biome").appendChild(i)})(),function(){_.x=0,_.y=0,_.angle=0,_.zoom=1,ot=0,at=0,it=!0;for(var t=0;t<Ge.length;t++){for(var n=[],i=0,o=Ve[Ge[t]].prototype.typesAmount;i<o;i++){var a=new Ve[Ge[t]](.5,.5,t,i,0),s=e("canvas");s.width=16,s.height=16;var r=s.getContext("2d");F=r,a.draw(),n.push(r.getImageData(0,0,16,16))}Ze.push(n)}}(),function(){for(var t=0;t<256;t++){var n=t.toString(2).padStart(8,"0"),i=e("canvas");i.width=22,i.height=22;var o=i.getContext("2d");"0"===n[0]&&"1"!==n[7]&&"1"!==n[1]&&(o.setTransform(1,0,0,1,11,11),o.drawImage(mt.shadowCorner.spr,-11,-11),o.setTransform(1,0,0,1,0,0));for(var a=2;a<8;a+=2)(check="0"===n[a]&&"1"!==n[a-1]&&"1"!==n[a+1])&&(o.setTransform(1,0,0,1,11,11),o.rotate(a*Ht/2),o.drawImage(mt.shadowCorner.spr,-11,-11),o.setTransform(1,0,0,1,0,0));for(a=1;a<8;a+=2)"0"===n[a]&&(o.setTransform(1,0,0,1,11,11),o.rotate((a-1)*Ht/2),o.drawImage(mt.shadowSide.spr,-11,-11),o.setTransform(1,0,0,1,0,0));Fe[n]=i}}(),ge(2),requestAnimationFrame(Pt),setInterval(Mt,1e3/tt),st&&setInterval(Lt,4)}function o(){if(0===nt)return{x:C.x-_.x,y:C.y-_.y};if(1===nt){var t=Y.cvs.width/2,e=Y.cvs.height/2;return{x:(C.x-t)/_.zoom+t-_.x,y:(C.y-e)/_.zoom+e-_.y}}t=Y.cvs.width/2,e=Y.cvs.height/2;var n={x:(C.x-t)/_.zoom+t-_.x,y:(C.y-e)/_.zoom+e-_.y},i={x:-_.x+U/2,y:-_.y+W/2},o=s(i,n)-_.angle,a=B(i,n);return{x:i.x+Math.cos(o)*a,y:i.y+Math.sin(o)*a}}function a(t,e){return Math.floor(Math.random()*(e-t+1))+t}function s(t,e){var n=e.x-t.x,i=e.y-t.y;return Math.atan2(i,n)}function r(){Object.keys(mt).length==gt.length&&xt.length==It?(i(),gt=[],xt=[],yt=[]):(F.fillStyle="#2d2d2d",F.fillRect(0,0,U,W),m(`audio:   ${It}/${xt.length}`,10,30,"white",2),m(`sprites: ${Object.keys(mt).length}/${gt.length}`,10,10,"white",2),F.setTransform(1,0,0,1,Math.round(U/2),Math.round(W/2)),F.rotate(ht),ht+=.1,F.drawImage(Z,Math.round(-8),Math.round(-8)),F.setTransform(1,0,0,1,0,0),requestAnimationFrame(r))}function h(t,e){let n,i=t.lastIndexOf(".");for(let e=i-1;kt.includes(t[e]);e--)n=e;let o=t.slice(n,i),a=Math.max(e.width,e.height)/2;mt[o]={spr:e,drawLimitSize:a}}function l(t){let e,n=t.lastIndexOf(".");for(let i=n-1;kt.includes(t[i]);i--)e=i;let i=t.slice(e,n);bt[i]={nodes:[],volNodes:[],src:t,type:"sfx",volume:1},bt[i].nodes=[1];let o=new Audio;o.onerror=function(){console.warn(rt+" "+t+" was not found")},o.src=t,o.preload="auto",o.addEventListener("canplaythrough",(function(){It++}),!1),bt[i].nodes.push(o);let a=Et.createMediaElementSource(o),s=Et.createGain();a.connect(s),s.connect(St),wt.push(a),At.push(s),bt[i].volNodes.push(At.length-1)}function c(){pt&&E[0]&&($(ut.sfx,C)&&(Tt.sfx=(C.x-(ut.sfx.x-60))/120),$(ut.bmg,C)&&(Tt.bgm=(C.x-(ut.bmg.x-60))/120)),C.x>U-32&&C.y<32?(k[0]&&(J.play(),dt=!0,pt=!pt),lt=25):lt=0,C.x<U-32&&C.x>U-64&&C.y<32?(ct=25,k[0]&&(J.play(),dt=!dt)):ct=0}function p(t,e,n,i=0,o=1,a=1){var s=t.drawLimitSize;if(e+s>V&&e-s<Q&&n+s>q&&n-s<K||it){let s=t.spr;0===i&&1===o&&1===a?F.drawImage(s,Math.round(e+_.x+ot-s.width/2),Math.round(n+_.y+at-s.height/2)):(F.setTransform(o,0,0,a,Math.round(e+_.x+ot),Math.round(n+_.y+at)),F.rotate(i),F.drawImage(s,Math.round(-s.width/2),Math.round(-s.height/2)),F.setTransform(1,0,0,1,0,0))}}function u(t,e,n,i=0,o=1,a=1){let s=t.spr;0===i&&1===o&&1===a?F.drawImage(s,Math.round(e+_.x+ot-s.width/2),Math.round(n+_.y+at-s.height/2)):(F.setTransform(o,0,0,a,Math.round(e+_.x+ot),Math.round(n+_.y+at)),F.rotate(i),F.drawImage(s,Math.round(-s.width/2),Math.round(-s.height/2)),F.setTransform(1,0,0,1,0,0))}function d(t,e,n,i,o){F.fillStyle=o,F.fillRect(t-n/2+_.x+ot,e-i/2+_.y+at,n,i)}function f(t,e,n,i){F.beginPath(),F.arc(t+_.x+ot,e+_.y+at,n,0,2*Math.PI,!1),F.fillStyle=i,F.fill()}function g(t,e,n,i){F.beginPath(),F.arc(t+_.x+ot,e+_.y+at,n,0,2*Math.PI,!1),F.strokeStyle=i,F.stroke()}function y(t,e,n,i){t+=_.x+ot,e+=_.y+at,F.fillStyle=i,F.beginPath(),F.moveTo(t+n[0].x,e+n[0].y);for(let i=1,o=n.length;i<o;i++)F.lineTo(t+n[i].x,e+n[i].y);F.fill()}function m(t,e,n,i="black",o=1,a=U){t=t.toString(),F.fillStyle=i,F.font=8*Math.round(o)+"px pixelmix";var s=t.split("\n");for(let t=0;t<s.length;t++)if(F.measureText(s[t]).width>a){var r=s[t].split(" "),h="",l=0;s.splice(t,1);for(let e=0;e<r.length;e++)F.measureText(h+r[e]+" ").width<a?h+=r[e]+" ":(0==e&&(h+=r[e]),s.splice(t+l,0,h),l++,h="",r.splice(0,0==e?1:e),e=-1);0!=h.length&&s.splice(t+l,0,h)}for(let t=0;t<s.length;t++)F.fillText(s[t],e+_.x+ot,n+_.y+at+(8*(t+(nt?1:0))*o+o*t))}function v(t,e){_.x=-t+Y.cvs.width/2,_.y=-e+Y.cvs.height/2}function x(t,e){_.x-=e*Math.sin(_.angle),_.y-=e*Math.cos(_.angle),_.x-=t*Math.sin(_.angle+1.57079632),_.y-=t*Math.cos(_.angle+1.57079632)}function w(t,e,n,i,o,a){a.setTransform(i,0,0,i,t,e),a.rotate(n),a.drawImage(o,-o.width/2,-o.height/2),a.setTransform(1,0,0,1,0,0)}var A={a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,BACKTICK:192,MINUS:189,EQUALS:187,OPENSQUARE:219,ENDSQUARE:221,SEMICOLON:186,SINGLEQUOTE:222,BACKSLASH:220,COMMA:188,PERIOD:190,SLASH:191,ENTER:13,BACKSPACE:8,TAB:9,CAPSLOCK:20,SHIFT:16,CONTROL:17,ALT:18,META:91,LEFTBACKSLASH:226,ESCAPE:27,HOME:36,END:35,PAGEUP:33,PAGEDOWN:34,DELETE:46,INSERT:45,PAUSE:19,UP:38,DOWN:40,LEFT:37,RIGHT:39,CONTEXT:93,SPACE:32,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123},I=[],T=[],k=[],E=[],S=0,C={x:0,y:0},P=[!1,!0,!0];function M(){for(var t=0;t<I.length;t++)I[t]&&(I[t]=0);for(t=0;t<k.length;t++)k[t]&&(k[t]=0);S=0}function L(t){var e=t.keyCode;I[e]=I[e]==[][[]]?1:0,T[e]=1,P[0]&&t.preventDefault()}function N(t){var e=t.keyCode;delete I[e],delete T[e]}function D(t){var e=t.button;k[e]=k[e]==[][[]]?1:0,E[e]=1,P[1]&&t.preventDefault()}function j(t){var e=t.button;delete k[e],delete E[e]}function O(t){C.x=t.offsetX,C.y=t.offsetY}function z(t){P[1]&&t.preventDefault()}function H(t){S+=t.deltaY/100*-1,P[2]&&t.preventDefault()}function B(t,e){let n=e.x-t.x,i=e.y-t.y;return Math.sqrt(n*n+i*i)}function R(t,e){return t.x+t.w/2>=e.x-e.w/2&&t.x-t.w/2<=e.x+e.w/2&&t.y+t.h/2>=e.y-e.h/2&&t.y-t.h/2<=e.y+e.h/2}function $(t,e){return t.x+t.w/2>=e.x&&t.x-t.w/2<=e.x&&t.y+t.h/2>=e.y&&t.y-t.h/2<=e.y}var U,W,F,G,V,Q,q,K,X,Z,J,Y={cvs:null,ctx:null,buffer1cvs:null,buffer1ctx:null,buffer2cvs:null,buffer2ctx:null},_={zoom:1,angle:0,x:0,y:0},tt=60,et=!1,nt=0,it=!1,ot=0,at=0,st=!0,rt="ðŸ›",ht=0,lt=0,ct=0,pt=!1,ut={},dt=!1,ft=[],gt=[],yt=[],mt={},vt=[],xt=[],bt={},wt=[],At=[],It=0,Tt={sfx:1,bgm:1};cursor={sprite:null,alignment:1,show:!0},mouseOnCanvas=!1;const kt="qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM1234567890_-. ";var Et,St,Ct;function Pt(){Y.cvs.width=document.body.clientWidth,Y.cvs.height=(document.body.offsetHeight<window.innerHeight?window.innerHeight:document.body.offsetHeight)-1,U=Y.cvs.width,W=Y.cvs.height,function(){switch(_.zoom<1&&(_.zoom=1),nt=0!=_.angle?2:1!=_.zoom?1:0){case 0:F=Y.ctx;break;case 1:F=Y.buffer1ctx;break;case 2:F=Y.buffer2ctx}}(),function(){G=Math.max(Y.cvs.width,Y.cvs.height),X=G-Math.min(Y.cvs.width,Y.cvs.height);var t=G/_.zoom,e=t+t/2;Y.buffer1cvs.width=U,Y.buffer1cvs.height=W,Y.buffer2cvs.width=e,Y.buffer2cvs.height=e,2===nt?(ot=(Y.buffer2cvs.width-Y.cvs.width)/2,at=(Y.buffer2cvs.height-Y.cvs.height)/2):(ot=0,at=0),Y.ctx.imageSmoothingEnabled=!1,Y.buffer1ctx.imageSmoothingEnabled=!1,Y.buffer2ctx.imageSmoothingEnabled=!1}(),Y.ctx.clearRect(0,0,Y.cvs.width,Y.cvs.height),Y.buffer1ctx.clearRect(0,0,Y.buffer1cvs.width,Y.buffer1cvs.height),Y.buffer2ctx.clearRect(0,0,Y.buffer2cvs.width,Y.buffer2cvs.height);var t=0;2==nt&&(t=Y.buffer2cvs.width-G),V=-_.x-(2==nt?X:0)-t,Q=-_.x+G+(2==nt?X:0)+t,q=-_.y-(2==nt?X:0)-t,K=-_.y+G+(2==nt?X:0)+t,En(),1===nt&&w(Y.cvs.width/2,Y.cvs.height/2,0,_.zoom,Y.buffer1cvs,Y.ctx),2===nt&&(w(Y.cvs.width/2,Y.cvs.height/2,_.angle,1,Y.buffer2cvs,Y.buffer1ctx),w(Y.cvs.width/2,Y.cvs.height/2,0,_.zoom,Y.buffer1cvs,Y.ctx)),F=Y.ctx,ot=0,at=0;var e={x:_.x,y:_.y},n=nt;_.x=0,_.y=0,nt=0,it=!0;try{!function(){switch(An){case mn.TITLE:case mn.OVERWORLD:case mn.BATTLE:case mn.LOADING:case mn.CUTSCENE:break;case mn.BUILDING:!function(){switch(be){case"pen":p(mt.buildPen,C.x+16,C.y+16,0,2,2);break;case"bucket":p(mt.buildBucket,C.x+16,C.y+16,0,2,2);break;case"pointer":p(mt.buildPointer,C.x+16,C.y+16,0,2,2)}}()}}()}catch(t){}it=!1;let i=U/2-100,o=W/2-100;ut.sfx={x:i+125,y:o+40,w:120,h:20},ut.bmg={x:i+125,y:o+70,w:120,h:20},function(){let t={x:U-16,y:16};d(t.x,t.y,34,34,"#9c9c9c");let e=lt+45;d(t.x,t.y,32,32,`rgb(${e},${e},${e})`),e=lt+69;let n=`rgb(${e},${e},${e})`;d(t.x,t.y-6,26,4,n),d(t.x-6,t.y-6,4,8,n),d(t.x,t.y+6,26,4,n),d(t.x+11,t.y+6,4,8,n),t.x-=33,d(t.x,t.y,34,34,"#9c9c9c"),e=ct+45,d(t.x,t.y,32,32,`rgb(${e},${e},${e})`),e=ct+69,n=`rgb(${e},${e},${e})`,dt?y(t.x,t.y,[{x:-7,y:-10},{x:-7,y:10},{x:10,y:0}],n):(d(t.x+6,t.y,6,20,n),d(t.x-6,t.y,6,20,n))}(),function(){if(pt){let t={x:U/2-100,y:W/2-100};d(U/2,W/2,200,200,"#242424"),m("sfx",t.x+2,t.y+30,"white",2),b=ut.sfx,d(b.x,b.y,b.w,b.h-10,"#444444"),d(b.x-60+120*Tt.sfx,b.y,8,20,"#444444"),m("bmg",t.x+2,t.y+60,"white",2),b=ut.bmg,d(b.x,b.y,b.w,b.h-10,"#444444"),d(b.x-60+120*Tt.bgm,b.y,8,20,"#444444")}}(),cursor.sprite&&mouseOnCanvas?(cursor.alignment?Y.ctx.drawImage(cursor.sprite.spr,C.x-Math.round(cursor.sprite.spr.width/2),C.y-Math.round(cursor.sprite.spr.height/2)):Y.ctx.drawImage(cursor.sprite.spr,C.x,C.y),cursor.show=!1):cursor.show=!0,nt=n,_.x=e.x,_.y=e.y,requestAnimationFrame(Pt)}function Mt(){0==st&&c(),St.gain.value=Tt.sfx,Ct.gain.value=Tt.bgm,dt||kn(),0==st&&M()}function Lt(){c(),dt||input(),M()}AudioContext=window.AudioContext||window.webkitAudioContext,t("game").onmouseout=function(){mouseOnCanvas=!1},t("game").onmouseover=function(){mouseOnCanvas=!0};const Nt=[[[0,0]],[[0,-1],[0,1]],[[0,0],[1,-2],[1,2]],[[0,-1],[0,1],[1,-3],[1,3]],[[0,0],[1,-2],[1,2],[2,-4],[2,4]]];function Dt(t){return 16*Math.round(t/16)}function jt(t,e,n){return Math.min(n,Math.max(e,t))}const Ot=2*Math.PI,zt=Math.PI,Ht=zt/2;function Bt(t,e,n){return e<0&&(e=Ot+e),t%Ot>e?t%Ot-e>zt?t+=n:t-=n:e-t%Ot>zt?t-=n:t+=n,Math.abs(t-e)<1.1*n&&(t=e),t>Ot&&(t-=Ot),t<0&&(t=Ot+t),t}function Rt(t,e,n,i,o){return i+(o-i)*(t-e)/(n-e)}var $t,Ut=0,Wt=0,Ft=[{update:function(){ee.x+=Math.cos(ee.angle)/2,ee.y+=Math.sin(ee.angle)/2,Ut>20&&(ge($t.room,$t.entranceID),Gt(1))},draw:function(){d(8*se,8*re,16*se,16*re,`rgba(0,0,0,${Rt(Ut,0,20,0,1)})`)}},{update:function(){ee.vel=1,ee.update(),Ut>$t.walkTime&&(An=mn.OVERWORLD)},draw:function(){d(8*se,8*re,16*se,16*re,`rgba(0,0,0,${Rt(Ut,0,20,1,0)})`)}},{update:function(){if(0===Ut){var t={x:-(_.x-Y.cvs.width/2),y:-(_.y-Y.cvs.height/2)};this.lerpAmount={x:(t.x-ee.x)/100,y:(t.y-ee.y)/100}}_.zoom=3+Ut/20,_.angle=3.4*(1-Math.cos(Ut/100*zt/2)),v(-(_.x-Y.cvs.width/2)-this.lerpAmount.x,-(_.y-Y.cvs.height/2)-this.lerpAmount.y),Ut>100&&function(t){ae=[Xt[t]];for(var e=0,n=Xt.length;e<n&&(e===t||(B(Xt[t],Xt[e])<50&&ae.push(Xt[e]),5!==ae.length));e++);le=[],ce=[],se=Math.floor(U/64)+2,re=Math.floor(W/64)+2;for(var i=0;i<re;i++){for(var o=[],s=0;s<se;s++){var r=de(he);o.push(new Ve[Ge[r[0]]](s,i,r[0],r[1],a(0,3)))}le.push(o)}var h={x:10*se,y:8*re},l=Nt[ae.length-1];for(e=0;e<l.length;e++)ae[e].x=h.x+16*l[e][0],ae[e].y=h.y+16*l[e][1],ae[e].angle=zt,ae[e].drawScale=1;ee.x=6*se,ee.y=8*re,ee.angle=0,ee.walkCycle=3,Sn(mn.BATTLE),Ue()}($t)},draw:function(){d(8*se,8*re,16*se,16*re,`rgba(0,0,0,${Rt(Ut*Ut*Ut,0,1e6,0,1)})`)}}];function Gt(t){Wt=t,An=mn.CUTSCENE,Ut=0}class Vt{constructor(t,e,n,i){this.x=t,this.y=e,this.w=n,this.h=i}get colliding(){for(var t=this.collisions,e=0,n=t.length;e<n;e++)if(R(this,t[e]))return!0;return!1}get collisions(){for(var t=[...ne,ee,...Xt],e=0,n=t.length;e<n;e++)if(t[e].x===this.x&&t[e].y===this.y){t.splice(e,1);break}return t}}class Qt extends Vt{constructor(){super(0,0,14,14),this.angle=0,this.vel=0,this.walkCycle=1}}Qt.prototype.update=function(){var t,e,n=!1,i=0,o=0;T[A.w]&&(this.vel+=.05,i-=Math.PI/2,n=!0,o++),T[A.s]&&(this.vel+=.05,n=!0,i+=Math.PI/2,o++),T[A.a]&&(this.vel+=.05,n=!0,i-=Math.PI*(T[A.s]?-1:1),o++),T[A.d]&&(this.vel+=.05,n=!0,o++),i/=o=0===o?1:o,n&&(this.angle=Bt(this.angle,i,.15)),this.vel=jt(this.vel,0,1),n||(this.vel=(t=this.vel,e=.3,t>0&&(t-=e),t<0&&(t+=e),Math.abs(t)<2*e&&(t=0),t));var a=this.collisions;this.x+=Math.cos(this.angle)*this.vel;for(var s=0,r=a.length;s<r;s++)R(this,a[s])&&(this.x-=Math.cos(this.angle)*this.vel);this.y+=Math.sin(this.angle)*this.vel;for(s=0,r=a.length;s<r;s++)R(this,a[s])&&(this.y-=Math.sin(this.angle)*this.vel);this.walkCycle+=Math.abs(this.vel/5),0==this.vel&&(this.walkCycle=3),this.walkCycle>=11&&(this.walkCycle=1),this.moveCamera(),this.w=18,this.h=18;for(s=0,r=Xt.length;s<r;s++)R(this,Xt[s])&&($t=s,Gt(2));this.w=14,this.h=14},Qt.prototype.moveCamera=function(){_.zoom=3;var t={x:this.x,y:this.y},e=le[0].length,n=le.length;48*n<W?t.y=8*le.length:(t.y<W/2/_.zoom&&(t.y=W/2/_.zoom),t.y>16*n-W/2/_.zoom&&(t.y=16*n-W/2/_.zoom)),48*e<U?t.x=8*le[0].length:(t.x<U/2/_.zoom&&(t.x=U/2/_.zoom),t.x>16*e-U/2/_.zoom&&(t.x=16*e-U/2/_.zoom)),v(t.x,t.y)},Qt.prototype.draw=function(){var t=Math.floor(this.walkCycle);u(mt["player"+(t=t>5?11-t:t)],this.x,this.y,this.angle)};var qt=["Slime","AngryHedge"],Kt={},Xt=[];const Zt=0,Jt=1;class Yt extends Vt{constructor(t,e,n,i,o){super(t,e,n,i),this.angle=0,this.speed=0,this.calculateVelocity(),this.agroed=!1,this.drawScale=1,this.variation=o,this.updateCount=0,this.spawnerObjectIndex=-1}}Yt.prototype.movementType=Zt,Yt.prototype.baseHP=10,Yt.prototype.agroRadius=200,Yt.prototype.imageName="debug",Yt.prototype.baseUpdate=function(){if(this.agroed){var t=0,e=0,n=this.collisions;switch(this.movementType){case Zt:this.speed=1;var i=this.updateCount%50;this.drawScale=1,i<25?(t=this.velocity.x*(i<18?1:.5),e=this.velocity.y*(i<18?1:.5),this.drawScale=1+Math.sin(i/7.65)/2):(this.angle=Bt(this.angle,s(this,ee),.05),this.calculateVelocity());break;case Jt:this.angle=Bt(this.angle,s(this,ee),.05),this.speed<.8&&(this.speed+=.1),this.calculateVelocity(),t=this.velocity.x,e=this.velocity.y}this.x+=t;for(var o=0,a=n.length;o<a;o++)if(R(this,n[o])){this.x-=t,"Object"!==n[o].__proto__.constructor.name&&(n[o].x+=t/2,n[o].colliding&&(n[o].x-=t/2));break}this.y+=e;for(o=0,a=n.length;o<a;o++)if(R(this,n[o])){this.y-=e,"Object"!==n[o].__proto__.constructor.name&&(n[o].y+=e/2,n[o].colliding&&(n[o].y-=e/2));break}}else B(this,ee)<this.agroRadius&&(this.agroed=!0);return this.updateCount++,!1},Yt.prototype.update=function(){},Yt.prototype.calculateVelocity=function(){this.velocity={x:Math.cos(this.angle)*this.speed,y:Math.sin(this.angle)*this.speed}},Yt.prototype.draw=function(){u(mt[`${this.imageName}${this.variation}`],this.x,this.y,this.angle,this.drawScale,this.drawScale)};class _t extends Yt{constructor(t,e,n){super(t,e,14,14,n)}}_t.prototype.imageName="slime",_t.prototype.movementType=Zt,_t.prototype.baseHP=10,Kt.Slime=_t;class te extends Yt{constructor(t,e,n){super(t,e,12,12,n)}}te.prototype.imageName="angryHedge",te.prototype.movementType=Jt,te.prototype.baseHP=10,Kt.AngryHedge=te;var ee=new Qt,ne=[];function ie(t){if(I[A.BACKSLASH]&&(In=mn.BUILDING,An=mn.LOADING,yn=!1),!Tn){for(var e=0,n=ce.length;e<n;e++)ce[e].update();ee.update(),function(){for(var t=0,e=Xt.length;t<e;t++)Xt[t].baseUpdate()&&-1!==Xt[t].spawnerObjectIndex&&(ce[Xt[t].spawnerObjectIndex].spawnCount--,Xt.splice(t,1),t--),Xt[t].update()}()}}function oe(){var t=8*le[0].length,e=8*le.length;u({spr:pe.ground,drawLimitSize:0},t,e),ee.draw(),function(){for(var t=0,e=Xt.length;t<e;t++)Xt[t].draw()}(),u({spr:pe.walls,drawLimitSize:0},t,e),u({spr:pe.objects,drawLimitSize:0},t,e)}var ae=[];var se,re,he,le=[],ce=[],pe={ground:null,walls:null,objects:null};const ue={grass:0,grassTown:1};function de(t){var e,n;switch(t){case ue.grass:case ue.grassTown:e=0,n=a(0,10)?0:1}return[e,n]}function fe(){var e={};e.name=t("name").value,e.biome=he,e.w=le[0].length,e.h=le.length;for(var n="",i=0;i<re;i++)for(var o=0;o<se;o++)n+=le[i][o].data+",";n=n.substring(0,n.length-1),e.tiles=n;for(var a="",s=0,r=ce.length;s<r;s++)a+=ce[s].data+",";return a=a.substring(0,a.length-1),e.objects=a,e}function ge(t,e=""){yn=!0,fetch($e+Re[t]).then(t=>t.json().then(t=>{ye(t),Ue(),me();for(var n=0,i=ce.length;n<i;n++){var o=ce[n];if(n+1===i&&(ee.x=100,ee.y=100),o.meta.entranceID===e){ee.x=o.x,ee.y=o.y,ee.angle=o.rotation,ee.x+=10*Math.cos(ee.angle),ee.y+=10*Math.sin(ee.angle);break}}for(n=0,i=ce.length;n<i;n++)ce[n].initialize();yn=!1}))}function ye(e){t("name").value=e.name;var n=e.w;t("roomW").value=e.w,se=n;var i=e.h;t("roomH").value=e.h,re=i,he=e.biome,le=[];for(var o=e.tiles.split(","),a=0;a<i;a++){for(var s=[],r=0;r<n;r++){var h=(u=o[r+a*n].split(".")).length;s.push(new(Ve[Ge[parseInt(u[0])]])(r,a,parseInt(u[0]),h>1?parseInt(u[1]):0,h>2?parseInt(u[2]):0))}le.push(s)}ce=[];var l=e.objects.split(",");if(l.length>0&&l[0].length>0)for(var c=0,p=l.length;c<p;c++){var u=l[c].split("~");ce.push(new(sn[an[parseInt(u[2])]])(parseInt(u[0])+.5,parseInt(u[1])+.5,parseInt(u[2]),parseInt(u[3]),parseInt(u[4]),u[5]))}}function me(){ne=[];for(var t=[],e=[],n=0;n<re;n++){for(var i=[],o=[],a=0;a<se;a++)i.push(le[n][a].layer===Xe.wall),o.push(!1);t.push(i),e.push(o)}for(n=0;n<re;n++)for(a=0;a<se;a++)if(!e[n][a]&&t[n][a]){for(var s=a;s<se&&t[n][s];)s++;s--;for(var r=n,h=!0;r<re&&t[r][s]&&h;){r++;for(var l=s;l>-1&&t[r][l];)l--;l+1!==a&&(h=!1,r--)}for(var c=n;c<r+1;c++)for(var p=a;p<s+1;p++)e[c][p]=!0;var u=(a+s+1)/2,d=(n+r+1)/2,f=s-a+1,g=r-n+1;ne.push({x:16*u,y:16*d,w:16*f,h:16*g})}}var ve=!1,xe={type:"tile",ID:0,variance:0,rotation:0,menuPos:{x:0,y:1},objectIndex:-1},be="pen",we={x:0,y:0},Ae=!1,Ie={states:[],pos:-1,lastStep:"forward",lastActionWasEdit:!1,bufferSize:200},Te=!1;function ke(n){if(n&&(Y.cvs.style.cursor="none",ve||(!function(){for(var n=0,i=e("tr"),o=0;o<Ge.length;o++){(a=e("button")).id="t"+o,a.xPos=n,a.yPos=t("buildTable").childNodes.length,a.onclick=function(){xe.menuPos.x=this.xPos,xe.menuPos.y=this.yPos,Le(parseInt(this.id.slice(1)))},i.appendChild(Be(a,mt[Ve[Ge[o]].prototype.imageName+"0"].spr.src,Ve[Ge[o]].prototype.layer?"#320738":"#08403a")),10===++n&&(t("buildTable").appendChild(i),i=e("tr"),n=0)}for(o=0;o<an.length;o++){var a;(a=e("button")).id="o"+o,a.xPos=n,a.yPos=t("buildTable").childNodes.length,a.onclick=function(){xe.menuPos.x=this.xPos,xe.menuPos.y=this.yPos,Ne(parseInt(this.id.slice(1)))},i.appendChild(Be(a,mt[sn[an[o]].prototype.imageName+"0"].spr.src,"#265917")),10===++n&&(t("buildTable").appendChild(i),i=e("tr"),n=0)}t("buildTable").appendChild(i),t("build").style.visibility="visible"}(),ve=!0),t("build").style.display="block",t("hideShow").style.display="block",t("object").style.display="block",xe.objectIndex=-1,Se()),I[A.BACKSLASH]&&(Y.cvs.style.cursor="crosshair",t("build").style.display="none",t("hideShow").style.display="none",t("object").style.display="none",Sn(mn.OVERWORLD),Ue(),me()),-1===xe.objectIndex)Oe.innerHTML="";else if(gn%10==0)for(var i=new sn[an[ce[xe.objectIndex].objectID]](0,0,0,0,0,"").metaArguments.length,a=0;a<i;a++){var s=t("objectMeta"+a);ce[xe.objectIndex].meta[s.labelName]=parseInt(s.value).toString().length===s.value.length?parseInt(s.value):s.value}he=parseInt(t("biome").value),Ae=t("randAngle").checked;var r=t("tableSelection").style;r.top=43*xe.menuPos.y-2+"px",r.left=42*xe.menuPos.x+"px",I[A.UP]&&Ce(0,-1)&&(xe.menuPos.y--,Me()),I[A.DOWN]&&Ce(0,1)&&(xe.menuPos.y++,Me()),I[A.LEFT]&&Ce(-1,0)&&(xe.menuPos.x--,Me()),I[A.RIGHT]&&Ce(1,0)&&(xe.menuPos.x++,Me());var h=t("buildVariations").children[0];if(void 0!==h){a=1;for(var l=h.children.length;a<10&&a<=l;a++)I[A[a+""]]&&h.children[a-1].children[0].onclick()}if(T[A.a]&&x(-10/_.zoom,0),T[A.d]&&x(10/_.zoom,0),T[A.w]&&x(0,-10/_.zoom),T[A.s]&&x(0,10/_.zoom),S&&(!(S<0)||_.zoom>1)){var c=1;S<0&&(c=-1);var p=1-_.zoom/(_.zoom+c),u=o();_.x-=(C.x-U/2)*p,_.y-=(C.y-W/2)*p,_.zoom+=c}if(I[A.q]&&--xe.rotation<0&&(xe.rotation=3),I[A.e]&&++xe.rotation>3&&(xe.rotation=0),I[A.x]&&(be="pen"),I[A.c]&&(be="bucket"),(I[A.v]||I[A.ESCAPE])&&(be="pointer"),I[A.ESCAPE]&&(t("enemyTable").style.display="none",xe.objectIndex=-1,Oe.innerHTML=""),(I[A.BACKSPACE]||I[A.DELETE]&&xe.objectIndex>-1)&&(ce.splice(xe.objectIndex,1),xe.objectIndex--,ze()),le.length>0){switch(I[A.SHIFT]&&v(8*(se-1),8*(re-1)),(u=o()).x=jt(Dt(u.x)/16,0,se-1),u.y=jt(Dt(u.y)/16,0,re-1),k[0]&&Se(),I[A.z]&&Ie.pos>-1&&(Ie.lastActionWasEdit?Ie.states.push(JSON.stringify(fe())):"forward"===Ie.lastStep&&Ie.pos--,ye(JSON.parse(Ie.states[Ie.pos])),Ie.pos--,Ie.lastStep="back",Ie.lastActionWasEdit=!1,xe.objectIndex=ce.length-1,ze()),I[A.y]&&Ie.pos<Ie.states.length-1&&("back"===Ie.lastStep&&Ie.pos++,Ie.pos++,ye(JSON.parse(Ie.states[Ie.pos])),Ie.lastStep="forward",Ie.lastActionWasEdit=!1,xe.objectIndex=ce.length-1,ze()),be){case"pen":if(E[0]&&(we.x!==u.x||we.y!==u.y)||k[0]){if(B(u,we)>1)for(var d=Math.min(we.x,u.x),f=Math.max(we.x,u.x),g=Math.min(we.y,u.y),y=Math.max(we.y,u.y),m=g;m<=y;m++)for(var b=d;b<=f;b++)Pe(b,m,we.x,we.y,u.x,u.y)<=.5&&Ee(b,m);Ee(u.x,u.y)}break;case"bucket":if(k[0]){var w=se,P=re,M=t("fillType").value,L=le[u.y][u.x].data,N=`${xe.ID}.${xe.variance}.${xe.rotation}`;if("id"===M&&(L=L.split(".")[0]),L!==N){var D=[];D.push([u.x,u.y]);var j=[],O=[];for(m=0;m<P;m++){var z=[],H=[];for(b=0;b<w;b++)z.push(!1),"id"===M?H.push(le[m][b].data.split(".")[0]):H.push(le[m][b].data);j.push(z),O.push(H)}for(w--,P--;D.length>0;){var R=D.pop();j[R[1]][R[0]]||(O[R[1]][R[0]]=N,Ee(R[0],R[1]),j[R[1]][R[0]]=!0,R[1]<P&&O[R[1]+1][R[0]]===L&&D.push([R[0],R[1]+1]),R[0]<w&&O[R[1]][R[0]+1]===L&&D.push([R[0]+1,R[1]]),R[1]>0&&O[R[1]-1][R[0]]===L&&D.push([R[0],R[1]-1]),R[0]>0&&O[R[1]][R[0]-1]===L&&D.push([R[0]-1,R[1]]))}}}break;case"pointer":if(k[0]){var F=o();F.x+=8,F.y+=8;for(a=0,l=ce.length;a<l;a++)if($(ce[a],F)){xe.objectIndex=a,ze();break}}}if(k[2]){var G=le[u.y][u.x];xe.type="tile",Le(G.tileID),xe.rotation=Math.round(G.rotation/Math.PI*2),xe.variance=G.variation}we=u}}function Ee(t,e){var n=xe.rotation;switch(Ae&&(n=a(0,3)),xe.type){case"tile":le[e][t]=new Ve[Ge[xe.ID]](t,e,xe.ID,xe.variance,n);break;case"object":xe.objectIndex=ce.length,ce.push(new sn[an[xe.ID]](t+.5,e+.5,xe.ID,xe.variance,n)),ze()}}function Se(){Ie.pos<Ie.states.length-1&&(Ie.states.length=Ie.pos+1),Ie.states.push(JSON.stringify(fe())),Ie.pos++,Ie.lastStep="forward",Ie.lastActionWasEdit=!0,Ie.states.length>Ie.bufferSize&&(Ie.states.shift(),Ie.pos--)}function Ce(e,n){if(xe.menuPos.y+n===0)return!1;var i=t("buildTable").children[xe.menuPos.y+n];return void 0!==i&&void 0!==i.children[xe.menuPos.x+e]}function Pe(t,e,n,i,o,a){var s,r,h=o-n,l=a-i,c=h*h+l*l,p=-1;0!=c&&(p=((t-n)*h+(e-i)*l)/c),p<0?(s=n,r=i):p>1?(s=o,r=a):(s=n+p*h,r=i+p*l);var u=t-s,d=e-r;return Math.sqrt(u*u+d*d)}function Me(){t("buildTable").children[xe.menuPos.y].children[xe.menuPos.x].children[0].onclick()}function Le(n){xe.type="tile",xe.ID=n,xe.variance=0,xe.rotation=0,xe.menuPos.x=n%10,xe.menuPos.y=Math.floor(n/10)+1;for(var i=e("tr"),o=Ve[Ge[n]],a=0,s=o.prototype.typesAmount;a<s;a++){var r=e("button");r.id="v"+a,r.style="width: 34px; height: 34px; padding:0;",r.onclick=function(){xe.variance=parseInt(this.id.slice(1))},i.appendChild(Be(r,mt[o.prototype.imageName+a].spr.src))}t("buildVariations").innerHTML="",t("buildVariations").appendChild(i);for(var h=Ge[n],l=`id: ${n}\n type: tile\n layer: ${o.prototype.layer}\n name: ${h}\n merges with: `,c=o.prototype.mergesWith,p=0;p<c.length;p++)l+=Ge[c[p]]+", ";t("buildInfo").innerText=l}function Ne(n){xe.type="object",xe.ID=n,xe.variance=0,xe.rotation=0;for(var i=e("tr"),o=sn[an[n]],a=0,s=o.prototype.typesAmount;a<s;a++){var r=e("button");r.id="v"+a,r.style="width: 34px; height: 34px; padding:0;",r.onclick=function(){xe.variance=parseInt(this.id[1])},i.appendChild(Be(r,mt[o.prototype.imageName+a].spr.src))}t("buildVariations").innerHTML="",t("buildVariations").appendChild(i);for(var h=`id: ${n}\n type: object\n name: ${an[n]}\n arguments: `,l=0,c=o.prototype.metaArguments.length;l<c;l++)h+=o.prototype.metaArguments[l][0]+", ";t("buildInfo").innerText=h}t("selectPen").onclick=function(){be="pen"},t("selectBucket").onclick=function(){be="bucket"},t("selectPointer").onclick=function(){be="pointer"},t("hideShow").onclick=function(){"hide"===this.innerText?(t("build").style.display="none",this.innerText="show",this.style.left="10px"):(t("build").style.display="block",this.innerText="hide",this.style.left="475px")},t("newRoom").onclick=function(){0!==le.length&&Se(),le=[],ce=[];for(var e=parseInt(t("roomW").value),n=parseInt(t("roomH").value),i=0;i<n;i++){for(var o=[],a=0;a<e;a++)o.push(new tn(a,i,0,0,0));le.push(o)}xe.objectIndex=-1,v(8*e,8*n)},t("help").onclick=function(){var e=t("helpDiv").style;e.display="block"===e.display?"none":"block"};var De,je,Oe=t("object");function ze(){if(-1!==xe.objectIndex){Oe.innerHTML="";for(var t=new sn[an[ce[xe.objectIndex].objectID]](0,0,0,0,0,"").metaArguments,e=0;e<t.length;e++)He(t[e][0],t[e][1],e,ce[xe.objectIndex].meta[t[e][0]])}}function He(n,i,o,a){var s,r=e("span");switch(r.innerText=n,r.style.paddingRight="20px",Oe.appendChild(r),i){case rn.string:(s=e("input")).type="text",s.value=void 0===a?"":a;break;case rn.number:(s=e("input")).type="number",s.value=void 0===a?"0":a;break;case rn.room:(s=e("select")).innerHTML=De.innerHTML,s.value=void 0===a?"0":a;break;case rn.enemy:(s=e("button")).onclick=function(){t("enemyTable").style.display="none"===t("enemyTable").style.display?"block":"none",je=s},s.innerText="select",s.value=void 0===a?"0":a}s.id="objectMeta"+o,s.labelName=n,s.onfocus=function(){Te=!0},s.onblur=function(){Te=!1},Oe.appendChild(s);var h=e("br");Oe.appendChild(h)}function Be(t,n,i="#00000000"){var o=e("td");o.style.backgroundColor=i,t.style="width: 34px; height: 34px; padding:0;";var a=e("img");return a.style.width="32px",a.style.height="32px",a.src=n,t.appendChild(a),o.appendChild(t),o}t("save").onclick=function(){var n=fe(),i=e("a");i.download=t("name").value;var o=new Blob([JSON.stringify(n)],{type:"application/json"});i.href=URL.createObjectURL(o);var a=document.createEvent("MouseEvents");a.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),i.dispatchEvent(a)},t("fileUpload").onchange=function(){void 0!==t("fileUpload").files[0]&&(0!==le.length&&Se(),fetch(URL.createObjectURL(t("fileUpload").files[0])).then(t=>t.json().then(t=>{ye(t),xe.objectIndex=-1,ze(),v(0,0)})))};var Re=["test.json","a.json","village.json"],$e="assets/rooms/";function Ue(){_.x=0,_.y=0,_.angle=0,_.zoom=1,ot=8,at=8,it=!0;for(var t=[[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1],[0,-1]],n=Object.keys(pe),i=0;i<n.length;i++)pe[n[i]]=e("canvas"),pe[n[i]].width=16*se,pe[n[i]].height=16*re;var o=pe.ground.getContext("2d");F=o;for(var a=0;a<re;a++)for(var s=0;s<se;s++)le[a][s].layer===Xe.ground&&le[a][s].draw();var r=o.getImageData(0,0,16*se,16*re);for(a=0;a<re;a++)for(s=0;s<se;s++){var h=le[a][s].mergesWith;a+1<re&&h.includes(le[a+1][s].tileID)&&We(r,le[a][s],16*s,16*(a+1),"bottom"),a-1>-1&&h.includes(le[a-1][s].tileID)&&We(r,le[a][s],16*s,16*(a-1),"top"),s+1<se&&h.includes(le[a][s+1].tileID)&&We(r,le[a][s],16*(s+1),16*a,"right"),s-1>-1&&h.includes(le[a][s-1].tileID)&&We(r,le[a][s],16*(s-1),16*a,"left")}o.putImageData(r,0,0);var l=pe.walls.getContext("2d");F=l;for(a=0;a<re;a++)for(s=0;s<se;s++)le[a][s].layer===Xe.wall&&le[a][s].draw();function c(t,e){return t<se&&t>-1&&e<re&&e>-1}for(a=0;a<re;a++)for(s=0;s<se;s++)if(le[a][s].layer===Xe.wall){var u="";for(i=0;i<8;i++){var d=t[i];c(s+d[0],a+d[1])?u+=le[a+d[1]][s+d[0]].layer===Xe.wall?"1":"0":u+="1"}p({spr:Fe[u],drawLimitSize:8},16*s,16*a)}ot=0,at=0;var f=pe.objects.getContext("2d");F=f;i=0;for(var g=ce.length;i<g;i++)ce[i].draw();yn=!1}function We(t,e,n,i,o){var s=4*t.width,r=4*n,h=i*s,l=t.data,c=Ze[e.tileID][e.variation].data;function p(t,e){worldPosition=e*s+h+4*t+r,tilePosition=64*e+4*t,l[worldPosition]=c[tilePosition],l[worldPosition+1]=c[tilePosition+1],l[worldPosition+2]=c[tilePosition+2],l[worldPosition+3]=c[tilePosition+3]}switch(o){case"top":for(var u=15;u>9;u--)for(var d=0;d<16;d++)0===a(0,(16-u)/2)&&p(d,u);break;case"bottom":for(u=0;u<6;u++)for(d=0;d<16;d++)0===a(0,u/2)&&p(d,u);break;case"right":for(u=0;u<16;u++)for(d=0;d<6;d++)0===a(0,d/2)&&p(d,u);break;case"left":for(u=0;u<16;u++)for(d=15;d>9;d--)0===a(0,(16-d)/2)&&p(d,u)}}var Fe={};var Ge=["TileGrass","TilePath","TileBrickPath","WallBrick","WallHouse"],Ve={};const Qe=0,qe=1,Ke=2,Xe={ground:0,wall:1};var Ze=[];class Je{constructor(t,e,n,i,o=0){this.x=16*t,this.y=16*e,this.tileID=n,this.variation=i,this.rotation=o*Math.PI/2}get data(){return 0!==this.rotation?`${this.tileID}.${this.variation}.${~~(this.rotation/Ht)}`:0!==this.variation?`${this.tileID}.${this.variation}`:""+this.tileID}}Je.prototype.w=16,Je.prototype.h=16,Je.prototype.imageName="debug",Je.prototype.typesAmount=1,Je.prototype.mergesWith=[],Je.prototype.effect=Qe,Je.prototype.layer=Xe.ground,Je.prototype.draw=function(){p(mt[`${this.imageName}${this.variation}`],this.x,this.y,this.rotation)},Ve.Tile=Je;class Ye extends Je{constructor(t,e,n,i,o=0){super(t,e,n,i,o)}}Ye.prototype.effect=qe,Ye.prototype.layer=Xe.wall,Ve.BaseWall=Ye;class _e extends Je{constructor(t,e,n,i,o=0){super(t,e,n,i,o)}}_e.prototype.imageName="brickPath",_e.prototype.typesAmount=3,_e.prototype.effect=Ke,Ve.TileBrickPath=_e;class tn extends Je{constructor(t,e,n,i,o=0){super(t,e,n,i,o)}}tn.prototype.imageName="grass",tn.prototype.typesAmount=2,tn.prototype.mergesWith=[0,1,3],Ve.TileGrass=tn;class en extends Je{constructor(t,e,n,i,o=0){super(t,e,n,i,o)}}en.prototype.imageName="path",en.prototype.effect=Ke,en.prototype.mergesWith=[3],Ve.TilePath=en;class nn extends Ye{constructor(t,e,n,i,o=0){super(t,e,n,i,o)}}nn.prototype.imageName="brick",nn.prototype.typesAmount=4,Ve.WallBrick=nn;class on extends Ye{constructor(t,e,n,i,o=0){super(t,e,n,i,o)}}on.prototype.imageName="house",on.prototype.typesAmount=3,Ve.WallHouse=on;var an=["HouseEntrance","HouseSmokeStack","Spawner","SpawnerSingle"],sn={};const rn={number:0,string:1,enemy:2,room:3};class hn{constructor(t,e,n,i,o=0,a=""){this.x=16*t,this.y=16*e,this.objectID=n,this.variation=i,this.rotation=o*Math.PI/2,this.meta={};for(var s=a.split("@"),r=0;r<this.metaArguments.length;r++){void 0===s[r]&&(s[r]=0);var h=s[r].length;h>0&&(parseInt(s[r]).toString().length===h?this.meta[this.metaArguments[r][0]]=parseInt(s[r]):this.meta[this.metaArguments[r][0]]=s[r])}}get data(){for(var t="",e=0;e<this.metaArguments.length;e++)t+=this.meta[this.metaArguments[e][0]]+"@";return t=t.substring(0,t.length-1),`${this.x/16-.5}~${this.y/16-.5}~${this.objectID}~${this.variation}~${~~(this.rotation/Ht)}~${t}`}}hn.prototype.imageName="debug",hn.prototype.typesAmount=1,hn.prototype.metaArguments=[],hn.prototype.w=16,hn.prototype.h=16,hn.prototype.draw=function(){p(mt[`${this.imageName}${this.variation}`],this.x,this.y,this.rotation)},hn.prototype.update=function(){return!1},hn.prototype.initialize=function(){},sn.BaseObject=hn;class ln extends hn{constructor(t,e,n,i,o=0,a=""){super(t,e,n,i,o,a)}}ln.prototype.imageName="houseEntrance",ln.prototype.metaArguments=[["room",rn.room],["entranceID",rn.string]],ln.prototype.update=function(){return B(this,ee)<8&&(ee.angle=s(ee,this),$t={room:this.meta.room,entranceID:this.meta.entranceID,walkTime:20},Gt(0)),!1},sn.HouseEntrance=ln;class cn extends hn{constructor(t,e,n,i,o=0,a=""){super(t,e,n,i,o,a),this.spawnCount=0}}cn.prototype.imageName="spawner",cn.prototype.metaArguments=[["enemyType",rn.enemy],["spawnCap",rn.number],["framesBetweenSpawns",rn.number],["range",rn.number]],cn.prototype.update=function(){if(gn%this.meta.framesBetweenSpawns==0&&this.spawnCount<this.meta.spawnCap){for(var t=a(this.x-this.meta.range,this.x+this.meta.range),e=a(this.y-this.meta.range,this.y+this.meta.range),n=new Kt[qt[this.meta.enemyType]](t,e,0),i=0;n.colliding&&i<50;)n.x=a(this.x-this.meta.range,this.x+this.meta.range),n.y=a(this.y-this.meta.range,this.y+this.meta.range),i++;i<50&&(n.spawnerObjectIndex=ce.indexOf(this),Xt.push(n),this.spawnCount++)}return!1},cn.prototype.draw=function(){yn||(p(mt[`${this.imageName}${this.variation}`],this.x,this.y,this.rotation),p(mt[Kt[qt[0|this.meta.enemyType]].prototype.imageName+"0"],this.x,this.y,0,.75,.75),g(this.x,this.y,this.meta.range,"#ffffff"))},sn.Spawner=cn;class pn extends hn{constructor(t,e,n,i,o=0,a=""){super(t,e,n,i,o,a)}}pn.prototype.imageName="spawnerSingle",pn.prototype.metaArguments=[["enemyType",rn.enemy]],pn.prototype.initialize=function(){Xt.push(new Kt[qt[this.meta.enemyType]](this.x,this.y,0))},pn.prototype.draw=function(){yn||(p(mt[`${this.imageName}${this.variation}`],this.x,this.y,this.rotation),p(mt[Kt[qt[0|this.meta.enemyType]].prototype.imageName+"0"],this.x,this.y,0,.75,.75),g(this.x,this.y,this.meta.range,"#ffffff"))},sn.SpawnerSingle=pn;class un extends hn{constructor(t,e,n,i,o=0,a=""){super(t,e,n,i,o,a)}}un.prototype.imageName="smokeStack",un.prototype.update=function(){return!1},sn.HouseSmokeStack=un;class dn{constructor(t="div"){this.element=e(t),this.children=[]}}dn.prototype.displayStyle="block",dn.prototype.update=function(){},dn.prototype.delete=function(){this.parent.element.removeChild(this.element),this.parent.children.splice(this.parent.children.indexOf(this),1)},dn.prototype.add=function(t){t.parent=this,this.element.appendChild(t.element),this.children.push(t)},dn.prototype.hide=function(){this.element.style.display="none"},dn.prototype.show=function(){this.element.style.display=this.displayStyle},dn.prototype.toggleVisibility=function(){"none"===this.element.style.display?this.show():this.hide()},ft=["assets/images/",["tiles/","debug0.png","grass0.png","grass1.png","path0.png","brick0.png","brick1.png","brick2.png","brick3.png","brickPath0.png","brickPath1.png","brickPath2.png","house0.png","house1.png","house2.png"],["objects/","tree0.png","tree1.png","link0.png","link1.png","houseEntrance0.png","smokeStack0.png","spawner0.png","spawnerSingle0.png"],["UI/slot","Accessory.png","Weapon.png","Select.png","Frame.png","Head.png","Body.png","Pants.png","Boots.png","Hand.png"],["entities/",["player","1.png","2.png","3.png","4.png","5.png"],["enemies/","slime0.png","angryHedge0.png"]],"preview0.png","tempPlayer.png","tempEnemy00.png","buildPen.png","buildBucket.png","buildPointer.png","shadowSide.png","shadowCorner.png"],vt=["assets/audio/"];var fn=0,gn=0,yn=!0;const mn={TITLE:0,LOADING:1,OVERWORLD:2,BATTLE:3,CUTSCENE:4,BUILDING:5};var vn,xn,bn,wn,An=mn.LOADING,In=mn.OVERWORLD,Tn=!1;function kn(){switch(xn=An!=vn,vn=An,An){case mn.TITLE:break;case mn.OVERWORLD:ie();break;case mn.BATTLE:!function(t){if(!Tn){for(var e=0,n=ae.length;e<n;e++);_.zoom=4,v(8*se,8*re)}}();break;case mn.LOADING:xn&&(t("load").style.display="block"),yn||(t("load").style.display="none",An=In);break;case mn.CUTSCENE:xn&&(Ut=0),Ft[Wt].update(),Ut++;break;case mn.BUILDING:Te||ke(xn),(k[0]||I[A.ESCAPE])&&([].forEach.call(document.getElementsByTagName("button"),t=>{t.blur()}),[].forEach.call(document.getElementsByTagName("select"),t=>{t.blur()}),[].forEach.call(document.getElementsByTagName("input"),t=>{t.blur()}))}gn++}function En(){switch(An){case mn.TITLE:break;case mn.OVERWORLD:oe();break;case mn.BATTLE:!function(){var t=8*le[0].length,e=8*le.length;u({spr:pe.ground,drawLimitSize:0},t,e),ee.draw();for(var n=0,i=ae.length;n<i;n++)ae[n].draw();u({spr:pe.walls,drawLimitSize:0},t,e),u({spr:pe.objects,drawLimitSize:0},t,e)}();break;case mn.LOADING:break;case mn.CUTSCENE:oe(),Ft[Wt].draw();break;case mn.BUILDING:!function(){for(var t=0;t<re;t++)for(var e=0;e<se;e++)le[t][e].draw();ot=-8,at=-8;for(var n=0,i=ce.length;n<i;n++)ce[n].draw();if(ot=0,at=0,le.length>0)if("pointer"===be){if(xe.objectIndex>-1&&xe.objectIndex<ce.length){var o=ce[xe.objectIndex];new sn[an[o.objectID]](o.x/16-.5,o.y/16-.5,o.objectID,o.variation,-o.rotation+Math.cos(fn/10)/5).draw()}}else"tile"===xe.type?new Ve[Ge[xe.ID]](we.x+Math.cos(fn/10)/10,we.y+Math.sin(fn/10)/10,xe.ID,xe.variance,xe.rotation).draw():new sn[an[xe.ID]](we.x+Math.cos(fn/10)/10,we.y+Math.sin(fn/10)/10,xe.ID,xe.variance,xe.rotation).draw()}()}fn++}function Sn(t){In=t,yn=!0,An=mn.LOADING}tt=60,Y.cvs=t("game"),Y.cvs.width=document.body.clientWidth,Y.cvs.height=document.body.offsetHeight<window.innerHeight?window.innerHeight:document.body.offsetHeight,U=Y.cvs.width,W=Y.cvs.height,Y.ctx=Y.cvs.getContext("2d",{alpha:!1}),Y.cvs.onmousedown=function(){et||(function(){var t="";function e(n,i){let o="";for(let a=0;a<n.length;a++){if("string"==typeof n[a])if(0==a)t+=n[a],o=n[a];else if("image"==i){let e=t+n[a];gt.push(e);let i=new Image;i.src=e,i.onerror=function(){console.warn(rt+" "+this.src+" was not found")},i.onload=function(){h(e,i)},yt.push(i)}else"sound"==i&&(xt.push(t+n[a]),l(t+n[a]));"object"==typeof n[a]&&e(n[a],i)}t=t.slice(0,t.length-o.length)}Et=new AudioContext,(St=Et.createGain()).connect(Et.destination),(Ct=Et.createGain()).connect(Et.destination),e(ft,"image"),e(vt,"sound"),(Z=new Image).src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAC4jAAAuIwF4pT92AAAAf0lEQVQ4jc2SuxHAIAxDbY4pMpHmyJSeKGuQKpyj2Hy6qETPQvhQCWRmDRfeZ4cJAGW28mAUyL4Pqmx2nfK+zaR59glRHo5qZi0BaPHmbDhiyuzdsza9wcrtEVtG4Ip+FLCzTM+WneWxPv9gpQUzmhncLPOHUCYfHr4/C4r2dQPfhkeIbjeYWgAAAABJRU5ErkJggg==",J=new Audio("data:audio/x-wav;base64,UklGRowBAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YWgBAADa/6T/2/+S/x//pP769Xr4fPh5+H34evh7+Pv6gf18/QIAhQcIDxUZFR4VHhgeEx6TFgkPCgqAAnz49/X18HLu7ubo4eXc5dzj3Gjf5+Fr5G7pce759YECiwwRFBQZlxuXG5cbFRmTFo8RCAoAAPz69/X08G7udO5s7vz1dvj++nv9gP3+/wEAgwKBAogHkBEpLUNG1lzqcPV683r4eu51ZmnVV7w+qypy88fDoKAXlAqKBoUAgIeHlpYsrTu87Ot9/ZIRGxkoKDEtqionIxgZiwfj5lnaz9JN0E3QV9pd3+Tm9fUBAAQFBwWNDBEPFxSYFpsWEA9+/fP1dfNt83bz8fX9+gQFkAwPDxQPEQ+IBwIAdfjv8OLm2+HX3Nrh4+bm63n4BAUUDx0ZqyCrJSkelBGEAnb4a+5a5Njcztxc31jkZunx9QgFGhQfGa0gqCCuIKkgpRsaFIsHdfhj6dfh0NzM19Th6es=");let n=U/2-100,i=W/2-100;ut.screenSize={x:n+160,y:i+12,w:50,h:20},ut.sfx={x:n+125,y:i+40,w:120,h:20},ut.bmg={x:n+125,y:i+70,w:120,h:20},r()}(),et=!0)},n("buffer1"),n("buffer2"),Y.ctx.imageSmoothingEnabled=!1,Y.buffer1ctx.imageSmoothingEnabled=!1,Y.buffer2ctx.imageSmoothingEnabled=!1,G=Math.max(Y.cvs.width,Y.cvs.height),X=G-Math.min(Y.cvs.width,Y.cvs.height),U=Y.cvs.width,W=Y.cvs.height,(bn=e("style")).innerHTML='\n    @font-face {\n        font-family: "pixelmix";\n        src: url(assets/pixelmix.ttf) format("truetype");\n        font-weight: 900;\n        font-style: normal;\n    }\n    html {font-family: "pixelmix" !important; font-size: 16px;}\n    ',document.head.appendChild(bn),Y.ctx.textBaseline="hanging",Y.ctx.textAlign="left",function(){var t=e("style");t.id="gamejsstyle",document.head.appendChild(t);var n=e("meta");n.setAttribute("charset","utf-8"),document.head.appendChild(n)}(),wn=Y.cvs,window.addEventListener("keydown",L),window.addEventListener("keyup",N),wn.addEventListener("mousedown",D),wn.addEventListener("mouseup",j),wn.addEventListener("mousemove",O),wn.addEventListener("contextmenu",z),wn.addEventListener("wheel",H),F=Y.ctx,requestAnimationFrame((function t(){Y.cvs.width=document.body.clientWidth,Y.cvs.height=(document.body.offsetHeight<window.innerHeight?window.innerHeight:document.body.offsetHeight)-1,U=Y.cvs.width,W=Y.cvs.height,F.fillStyle="#101010",F.fillRect(0,0,U,W),f(U/2,W/2,27,"#066312"),f(U/2,W/2,23,"#149124"),y(U/2,W/2,[{x:-7,y:-15},{x:-7,y:15},{x:15,y:0}],"#47f55d"),et||requestAnimationFrame(t)}))