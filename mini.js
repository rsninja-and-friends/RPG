function t(t){return document.getElementById(t)}function e(t){return document.createElement(t)}function n(n){var o=e("canvas");o.id=n,o.width=J.cvs.width,o.height=J.cvs.height,o.style="image-rendering:pixelated;image-rendering: crisp-edges;display:none",document.body.appendChild(o),J[n+"cvs"]=t(n),J[n+"ctx"]=J[n+"cvs"].getContext("2d")}function o(){try{input}catch(t){it=!1}(function(){Pe=e("select");for(var n=0;n<Le.length;n++){var o=e("option"),a=Le[n].lastIndexOf("/");o.innerText=-1===a?Le[n]:Le[n].substring(a+1),o.value=n,Pe.appendChild(o)}var i=e("table"),r=e("tr"),s=0;for(n=0;n<Vt.length;n++){var l=e("button");l.id="e"+n,l.xPos=s,l.yPos=i.childNodes.length,l.onclick=function(){Ce.value=this.id.slice(1),Ce.innerText=Vt[this.id.slice(1)]},r.appendChild(De(l,yt[Qt[Vt[n]].prototype.imageName+"0"].spr.src,"#2e2e2e")),10==++s&&(i.appendChild.appendChild(r),r=e("tr"),s=0)}i.appendChild(r),t("enemyTable").appendChild(i)})(),function(){Y.x=0,Y.y=0,Y.angle=0,Y.zoom=1,ot=0,at=0,nt=!0;for(var t=0;t<Be.length;t++){for(var n=[],o=0,a=Re[Be[t]].prototype.typesAmount;o<a;o++){var i=new Re[Be[t]](.5,.5,t,o,0),r=e("canvas");r.width=16,r.height=16;var s=r.getContext("2d");F=s,i.draw(),n.push(s.getImageData(0,0,16,16))}We.push(n)}}(),function(){for(var t=0;t<256;t++){var n=t.toString(2).padStart(8,"0"),o=e("canvas");o.width=22,o.height=22;var a=o.getContext("2d");"0"===n[0]&&"1"!==n[7]&&"1"!==n[1]&&(a.setTransform(1,0,0,1,11,11),a.drawImage(yt.shadowCorner.spr,-11,-11),a.setTransform(1,0,0,1,0,0));for(var i=2;i<8;i+=2)(check="0"===n[i]&&"1"!==n[i-1]&&"1"!==n[i+1])&&(a.setTransform(1,0,0,1,11,11),a.rotate(i*Ht/2),a.drawImage(yt.shadowCorner.spr,-11,-11),a.setTransform(1,0,0,1,0,0));for(i=1;i<8;i+=2)"0"===n[i]&&(a.setTransform(1,0,0,1,11,11),a.rotate((i-1)*Ht/2),a.drawImage(yt.shadowSide.spr,-11,-11),a.setTransform(1,0,0,1,0,0));ze[n]=o}}(),ce(2),requestAnimationFrame(Ct),setInterval(St,1e3/_),it&&setInterval(Mt,4)}function a(){if(0===et)return{x:P.x-Y.x,y:P.y-Y.y};if(1===et){var t=J.cvs.width/2,e=J.cvs.height/2;return{x:(P.x-t)/Y.zoom+t-Y.x,y:(P.y-e)/Y.zoom+e-Y.y}}t=J.cvs.width/2,e=J.cvs.height/2;var n={x:(P.x-t)/Y.zoom+t-Y.x,y:(P.y-e)/Y.zoom+e-Y.y},o={x:-Y.x+G/2,y:-Y.y+$/2},a=r(o,n)-Y.angle,i=z(o,n);return{x:o.x+Math.cos(a)*i,y:o.y+Math.sin(a)*i}}function i(t,e){return Math.floor(Math.random()*(e-t+1))+t}function r(t,e){var n=e.x-t.x,o=e.y-t.y;return Math.atan2(o,n)}function s(){Object.keys(yt).length==ft.length&&vt.length==It?(o(),ft=[],vt=[],gt=[]):(F.fillStyle="#2d2d2d",F.fillRect(0,0,G,$),y(`audio:   ${It}/${vt.length}`,10,30,"white",2),y(`sprites: ${Object.keys(yt).length}/${ft.length}`,10,10,"white",2),F.setTransform(1,0,0,1,Math.round(G/2),Math.round($/2)),F.rotate(st),st+=.1,F.drawImage(X,Math.round(-8),Math.round(-8)),F.setTransform(1,0,0,1,0,0),requestAnimationFrame(s))}function l(t,e){let n,o=t.lastIndexOf(".");for(let e=o-1;kt.includes(t[e]);e--)n=e;let a=t.slice(n,o),i=Math.max(e.width,e.height)/2;yt[a]={spr:e,drawLimitSize:i}}function c(t){let e,n=t.lastIndexOf(".");for(let o=n-1;kt.includes(t[o]);o--)e=o;let o=t.slice(e,n);xt[o]={nodes:[],volNodes:[],src:t,type:"sfx",volume:1},xt[o].nodes=[1];let a=new Audio;a.onerror=function(){console.warn(rt+" "+t+" was not found")},a.src=t,a.preload="auto",a.addEventListener("canplaythrough",(function(){It++}),!1),xt[o].nodes.push(a);let i=Et.createMediaElementSource(a),r=Et.createGain();i.connect(r),r.connect(Tt),bt.push(i),wt.push(r),xt[o].volNodes.push(wt.length-1)}function h(){ht&&E[0]&&(R(ut.sfx,P)&&(At.sfx=(P.x-(ut.sfx.x-60))/120),R(ut.bmg,P)&&(At.bgm=(P.x-(ut.bmg.x-60))/120)),P.x>G-32&&P.y<32?(k[0]&&(Z.play(),pt=!0,ht=!ht),lt=25):lt=0,P.x<G-32&&P.x>G-64&&P.y<32?(ct=25,k[0]&&(Z.play(),pt=!pt)):ct=0}function u(t,e,n,o=0,a=1,i=1){var r=t.drawLimitSize;if(e+r>W&&e-r<V&&n+r>Q&&n-r<q||nt){let r=t.spr;0===o&&1===a&&1===i?F.drawImage(r,Math.round(e+Y.x+ot-r.width/2),Math.round(n+Y.y+at-r.height/2)):(F.setTransform(a,0,0,i,Math.round(e+Y.x+ot),Math.round(n+Y.y+at)),F.rotate(o),F.drawImage(r,Math.round(-r.width/2),Math.round(-r.height/2)),F.setTransform(1,0,0,1,0,0))}}function p(t,e,n,o=0,a=1,i=1){let r=t.spr;0===o&&1===a&&1===i?F.drawImage(r,Math.round(e+Y.x+ot-r.width/2),Math.round(n+Y.y+at-r.height/2)):(F.setTransform(a,0,0,i,Math.round(e+Y.x+ot),Math.round(n+Y.y+at)),F.rotate(o),F.drawImage(r,Math.round(-r.width/2),Math.round(-r.height/2)),F.setTransform(1,0,0,1,0,0))}function d(t,e,n,o,a){F.fillStyle=a,F.fillRect(t-n/2+Y.x+ot,e-o/2+Y.y+at,n,o)}function f(t,e,n,o){F.beginPath(),F.arc(t+Y.x+ot,e+Y.y+at,n,0,2*Math.PI,!1),F.fillStyle=o,F.fill()}function g(t,e,n,o){t+=Y.x+ot,e+=Y.y+at,F.fillStyle=o,F.beginPath(),F.moveTo(t+n[0].x,e+n[0].y);for(let o=1,a=n.length;o<a;o++)F.lineTo(t+n[o].x,e+n[o].y);F.fill()}function y(t,e,n,o="black",a=1,i=G){t=t.toString(),F.fillStyle=o,F.font=8*Math.round(a)+"px pixelmix";var r=t.split("\n");for(let t=0;t<r.length;t++)if(F.measureText(r[t]).width>i){var s=r[t].split(" "),l="",c=0;r.splice(t,1);for(let e=0;e<s.length;e++)F.measureText(l+s[e]+" ").width<i?l+=s[e]+" ":(0==e&&(l+=s[e]),r.splice(t+c,0,l),c++,l="",s.splice(0,0==e?1:e),e=-1);0!=l.length&&r.splice(t+c,0,l)}for(let t=0;t<r.length;t++)F.fillText(r[t],e+Y.x+ot,n+Y.y+at+(8*(t+(et?1:0))*a+a*t))}function m(t,e){Y.x=-t+J.cvs.width/2,Y.y=-e+J.cvs.height/2}function v(t,e){Y.x-=e*Math.sin(Y.angle),Y.y-=e*Math.cos(Y.angle),Y.x-=t*Math.sin(Y.angle+1.57079632),Y.y-=t*Math.cos(Y.angle+1.57079632)}function x(t,e,n,o,a,i){i.setTransform(o,0,0,o,t,e),i.rotate(n),i.drawImage(a,-a.width/2,-a.height/2),i.setTransform(1,0,0,1,0,0)}var w={a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,BACKTICK:192,MINUS:189,EQUALS:187,OPENSQUARE:219,ENDSQUARE:221,SEMICOLON:186,SINGLEQUOTE:222,BACKSLASH:220,COMMA:188,PERIOD:190,SLASH:191,ENTER:13,BACKSPACE:8,TAB:9,CAPSLOCK:20,SHIFT:16,CONTROL:17,ALT:18,META:91,LEFTBACKSLASH:226,ESCAPE:27,HOME:36,END:35,PAGEUP:33,PAGEDOWN:34,DELETE:46,INSERT:45,PAUSE:19,UP:38,DOWN:40,LEFT:37,RIGHT:39,CONTEXT:93,SPACE:32,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123},I=[],A=[],k=[],E=[],T=0,P={x:0,y:0},C=[!1,!0,!0];function S(){for(var t=0;t<I.length;t++)I[t]&&(I[t]=0);for(t=0;t<k.length;t++)k[t]&&(k[t]=0);T=0}function M(t){var e=t.keyCode;I[e]=I[e]==[][[]]?1:0,A[e]=1,C[0]&&t.preventDefault()}function N(t){var e=t.keyCode;delete I[e],delete A[e]}function D(t){var e=t.button;k[e]=k[e]==[][[]]?1:0,E[e]=1,C[1]&&t.preventDefault()}function L(t){var e=t.button;delete k[e],delete E[e]}function j(t){P.x=t.offsetX,P.y=t.offsetY}function H(t){C[1]&&t.preventDefault()}function O(t){T+=t.deltaY/100*-1,C[2]&&t.preventDefault()}function z(t,e){let n=e.x-t.x,o=e.y-t.y;return Math.sqrt(n*n+o*o)}function B(t,e){return t.x+t.w/2>=e.x-e.w/2&&t.x-t.w/2<=e.x+e.w/2&&t.y+t.h/2>=e.y-e.h/2&&t.y-t.h/2<=e.y+e.h/2}function R(t,e){return t.x+t.w/2>=e.x&&t.x-t.w/2<=e.x&&t.y+t.h/2>=e.y&&t.y-t.h/2<=e.y}var G,$,F,U,W,V,Q,q,K,X,Z,J={cvs:null,ctx:null,buffer1cvs:null,buffer1ctx:null,buffer2cvs:null,buffer2ctx:null},Y={zoom:1,angle:0,x:0,y:0},_=60,tt=!1,et=0,nt=!1,ot=0,at=0,it=!0,rt="ðŸ›",st=0,lt=0,ct=0,ht=!1,ut={},pt=!1,dt=[],ft=[],gt=[],yt={},mt=[],vt=[],xt={},bt=[],wt=[],It=0,At={sfx:1,bgm:1};cursor={sprite:null,alignment:1,show:!0},mouseOnCanvas=!1;const kt="qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM1234567890_-. ";var Et,Tt,Pt;function Ct(){J.cvs.width=document.body.clientWidth,J.cvs.height=(document.body.offsetHeight<window.innerHeight?window.innerHeight:document.body.offsetHeight)-1,G=J.cvs.width,$=J.cvs.height,function(){switch(Y.zoom<1&&(Y.zoom=1),et=0!=Y.angle?2:1!=Y.zoom?1:0){case 0:F=J.ctx;break;case 1:F=J.buffer1ctx;break;case 2:F=J.buffer2ctx}}(),function(){U=Math.max(J.cvs.width,J.cvs.height),K=U-Math.min(J.cvs.width,J.cvs.height);var t=U/Y.zoom,e=t+t/2;J.buffer1cvs.width=G,J.buffer1cvs.height=$,J.buffer2cvs.width=e,J.buffer2cvs.height=e,2===et?(ot=(J.buffer2cvs.width-J.cvs.width)/2,at=(J.buffer2cvs.height-J.cvs.height)/2):(ot=0,at=0),J.ctx.imageSmoothingEnabled=!1,J.buffer1ctx.imageSmoothingEnabled=!1,J.buffer2ctx.imageSmoothingEnabled=!1}(),J.ctx.clearRect(0,0,J.cvs.width,J.cvs.height),J.buffer1ctx.clearRect(0,0,J.buffer1cvs.width,J.buffer1cvs.height),J.buffer2ctx.clearRect(0,0,J.buffer2cvs.width,J.buffer2cvs.height);var t=0;2==et&&(t=J.buffer2cvs.width-U),W=-Y.x-(2==et?K:0)-t,V=-Y.x+U+(2==et?K:0)+t,Q=-Y.y-(2==et?K:0)-t,q=-Y.y+U+(2==et?K:0)+t,vn(),1===et&&x(J.cvs.width/2,J.cvs.height/2,0,Y.zoom,J.buffer1cvs,J.ctx),2===et&&(x(J.cvs.width/2,J.cvs.height/2,Y.angle,1,J.buffer2cvs,J.buffer1ctx),x(J.cvs.width/2,J.cvs.height/2,0,Y.zoom,J.buffer1cvs,J.ctx)),F=J.ctx,ot=0,at=0;var e={x:Y.x,y:Y.y},n=et;Y.x=0,Y.y=0,et=0,nt=!0;try{!function(){switch(fn){case cn.TITLE:case cn.OVERWORLD:case cn.FIGHTING:case cn.LOADING:case cn.CUTSCENE:break;case cn.BUILDING:!function(){switch(fe){case"pen":u(yt.buildPen,P.x+16,P.y+16,0,2,2);break;case"bucket":u(yt.buildBucket,P.x+16,P.y+16,0,2,2);break;case"pointer":u(yt.buildPointer,P.x+16,P.y+16,0,2,2)}}()}}()}catch(t){}nt=!1;let o=G/2-100,a=$/2-100;ut.sfx={x:o+125,y:a+40,w:120,h:20},ut.bmg={x:o+125,y:a+70,w:120,h:20},function(){let t={x:G-16,y:16};d(t.x,t.y,34,34,"#9c9c9c");let e=lt+45;d(t.x,t.y,32,32,`rgb(${e},${e},${e})`),e=lt+69;let n=`rgb(${e},${e},${e})`;d(t.x,t.y-6,26,4,n),d(t.x-6,t.y-6,4,8,n),d(t.x,t.y+6,26,4,n),d(t.x+11,t.y+6,4,8,n),t.x-=33,d(t.x,t.y,34,34,"#9c9c9c"),e=ct+45,d(t.x,t.y,32,32,`rgb(${e},${e},${e})`),e=ct+69,n=`rgb(${e},${e},${e})`,pt?g(t.x,t.y,[{x:-7,y:-10},{x:-7,y:10},{x:10,y:0}],n):(d(t.x+6,t.y,6,20,n),d(t.x-6,t.y,6,20,n))}(),function(){if(ht){let t={x:G/2-100,y:$/2-100};d(G/2,$/2,200,200,"#242424"),y("sfx",t.x+2,t.y+30,"white",2),b=ut.sfx,d(b.x,b.y,b.w,b.h-10,"#444444"),d(b.x-60+120*At.sfx,b.y,8,20,"#444444"),y("bmg",t.x+2,t.y+60,"white",2),b=ut.bmg,d(b.x,b.y,b.w,b.h-10,"#444444"),d(b.x-60+120*At.bgm,b.y,8,20,"#444444")}}(),cursor.sprite&&mouseOnCanvas?(cursor.alignment?J.ctx.drawImage(cursor.sprite.spr,P.x-Math.round(cursor.sprite.spr.width/2),P.y-Math.round(cursor.sprite.spr.height/2)):J.ctx.drawImage(cursor.sprite.spr,P.x,P.y),cursor.show=!1):cursor.show=!0,et=n,Y.x=e.x,Y.y=e.y,requestAnimationFrame(Ct)}function St(){0==it&&h(),Tt.gain.value=At.sfx,Pt.gain.value=At.bgm,pt||mn(),0==it&&S()}function Mt(){h(),pt||input(),S()}function Nt(t){return 16*Math.round(t/16)}function Dt(t,e,n){return Math.min(n,Math.max(e,t))}AudioContext=window.AudioContext||window.webkitAudioContext,t("game").onmouseout=function(){mouseOnCanvas=!1},t("game").onmouseover=function(){mouseOnCanvas=!0};const Lt=2*Math.PI,jt=Math.PI,Ht=jt/2;function Ot(t,e,n){return e<0&&(e=Lt+e),t%Lt>e?t%Lt-e>jt?t+=n:t-=n:e-t%Lt>jt?t-=n:t+=n,Math.abs(t-e)<1.1*n&&(t=e),t>Lt&&(t-=Lt),t<0&&(t=Lt+t),t}function zt(t,e,n,o,a){return o+(a-o)*(t-e)/(n-e)}var Bt,Rt=0,Gt=0,$t=[{update:()=>{_t.x+=Math.cos(_t.angle)/2,_t.y+=Math.sin(_t.angle)/2,Rt>20&&(ce(Bt.room,Bt.entranceID),Ft(1))},draw:()=>{d(8*oe,8*ae,16*oe,16*ae,`rgba(0,0,0,${zt(Rt,0,20,0,1)})`)}},{update:()=>{_t.vel=1,_t.update(),Rt>Bt.walkTime&&(fn=cn.OVERWORLD)},draw:()=>{d(8*oe,8*ae,16*oe,16*ae,`rgba(0,0,0,${zt(Rt,0,20,1,0)})`)}}];function Ft(t){Gt=t,fn=cn.CUTSCENE,Rt=0}class Ut{constructor(t,e,n,o){this.x=t,this.y=e,this.w=n,this.h=o}get colliding(){for(var t=this.collisions,e=0,n=t.length;e<n;e++)if(B(this,t[e]))return!0;return!1}get collisions(){for(var t=[...te,_t,...qt],e=0,n=t.length;e<n;e++)if(t[e].x===this.x&&t[e].y===this.y){t.splice(e,1);break}return t}}class Wt extends Ut{constructor(){super(0,0,14,14),this.angle=0,this.vel=0,this.walkCycle=1}}Wt.prototype.update=function(){var t,e,n=!1,o=0,a=0;A[w.w]&&(this.vel+=.05,o-=Math.PI/2,n=!0,a++),A[w.s]&&(this.vel+=.05,n=!0,o+=Math.PI/2,a++),A[w.a]&&(this.vel+=.05,n=!0,o-=Math.PI*(A[w.s]?-1:1),a++),A[w.d]&&(this.vel+=.05,n=!0,a++),o/=a=0===a?1:a,n&&(this.angle=Ot(this.angle,o,.15)),this.vel=Dt(this.vel,0,1),n||(this.vel=(t=this.vel,e=.3,t>0&&(t-=e),t<0&&(t+=e),Math.abs(t)<2*e&&(t=0),t));var i=this.collisions;this.x+=Math.cos(this.angle)*this.vel;for(var r=0,s=i.length;r<s;r++)B(this,i[r])&&(this.x-=Math.cos(this.angle)*this.vel);this.y+=Math.sin(this.angle)*this.vel;for(r=0,s=i.length;r<s;r++)B(this,i[r])&&(this.y-=Math.sin(this.angle)*this.vel);this.walkCycle+=Math.abs(this.vel/5),0==this.vel&&(this.walkCycle=3),this.walkCycle>=11&&(this.walkCycle=1),this.moveCamera()},Wt.prototype.moveCamera=function(){Y.zoom=3;var t={x:this.x,y:this.y},e=ie[0].length,n=ie.length;48*n<$?t.y=8*ie.length:(t.y<$/2/Y.zoom&&(t.y=$/2/Y.zoom),t.y>16*n-$/2/Y.zoom&&(t.y=16*n-$/2/Y.zoom)),48*e<G?t.x=8*ie[0].length:(t.x<G/2/Y.zoom&&(t.x=G/2/Y.zoom),t.x>16*e-G/2/Y.zoom&&(t.x=16*e-G/2/Y.zoom)),m(t.x,t.y)},Wt.prototype.draw=function(){var t=Math.floor(this.walkCycle);u(yt["player"+(t=t>5?11-t:t)],this.x,this.y,this.angle)};var Vt=["Slime","AngryHedge"],Qt={},qt=[];const Kt=0,Xt=1;class Zt extends Ut{constructor(t,e,n,o,a){super(t,e,n,o),this.angle=angle,this.speed=0,this.velocity=this.calculateVelocity(),this.agroed=!1,this.drawScale=1,this.variation=a,this.updateCount=0}}Zt.prototype.movementType=Kt,Zt.prototype.baseHP=10,Zt.prototype.agroRadius=200,Zt.prototype.imageName="debug",Zt.prototype.baseUpdate=function(){if(this.agroed){var t=0,e=0,n=this.collisions;switch(this.movementType){case Kt:var o=this.updateCount%50;this.drawScale=1,o<25?(t=this.velocity.x*(o<18?1:.5),e=this.velocity.y*(o<18?1:.5),this.drawScale=1+Math.sin(o/7.65)/2):(this.angle=Ot(this.angle,r(this,_t),.05),this.velocity={x:Math.cos(this.angle),y:Math.sin(this.angle)});break;case Xt:t=this.velocity.x,e=this.velocity.y,this.angle=Ot(this.angle,r(this,_t),.05),this.velocity={x:Math.cos(this.angle),y:Math.sin(this.angle)}}this.x+=t;for(var a=0,i=n.length;a<i;a++)if(B(this,n[a])){this.x-=t,"Object"!==n[a].__proto__.constructor.name&&(n[a].x+=t/2);break}this.y+=e;for(a=0,i=n.length;a<i;a++)if(B(this,n[a])){this.y-=e,"Object"!==n[a].__proto__.constructor.name&&(n[a].y+=e/2);break}}else z(this,_t)<this.agroRadius&&(this.agroed=!0);this.updateCount++},Zt.prototype.update=function(){},Zt.prototype.calculateVelocity=function(){this.velocity={x:Math.cos(this.angle)*this.calculateVelocity,y:Math.sin(this.angle)*this.calculateVelocity}},Zt.prototype.draw=function(){u(yt[`${this.imageName}${this.variation}`],this.x,this.y,this.angle,this.drawScale,this.drawScale)};class Jt extends Ut{constructor(t,e){super(t,e,14,14)}}Jt.prototype.imageName="slime",Jt.prototype.movementType=Kt,Jt.prototype.baseHP=10,Qt.Slime=Jt;class Yt extends Ut{constructor(t,e){super(t,e,14,14)}}Yt.prototype.imageName="angryHedge",Yt.prototype.movementType=Xt,Yt.prototype.baseHP=10,Qt.AngryHedge=Yt;var _t=new Wt,te=[];function ee(t){if(I[w.BACKSLASH]&&(gn=cn.BUILDING,fn=cn.LOADING,ln=!1),!yn){for(var e=0,n=re.length;e<n;e++)re[e].update();_t.update(),function(){for(var t=0,e=qt.length;t<e;t++)qt[t].baseUpdate(),qt[t].update()}()}}function ne(){var t=8*ie[0].length,e=8*ie.length;p({spr:se.ground,drawLimitSize:0},t,e),_t.draw(),function(){for(var t=0,e=qt.length;t<e;t++)qt[t].draw()}(),p({spr:se.walls,drawLimitSize:0},t,e),p({spr:se.objects,drawLimitSize:0},t,e)}var oe,ae,ie=[],re=[],se={ground:null,walls:null,objects:null};function le(){var e={};e.name=t("name").value,e.w=ie[0].length,e.h=ie.length;for(var n="",o=0;o<ae;o++)for(var a=0;a<oe;a++)n+=ie[o][a].data+",";n=n.substring(0,n.length-1),e.tiles=n;for(var i="",r=0,s=re.length;r<s;r++)i+=re[r].data+",";return i=i.substring(0,i.length-1),e.objects=i,e}function ce(t,e=""){ln=!0,fetch(je+Le[t]).then(t=>t.json().then(t=>{he(t),He(),ue();for(var n=0,o=re.length;n<o;n++){var a=re[n];if(n+1===o&&(_t.x=100,_t.y=100),a.meta.entranceID===e){_t.x=a.x,_t.y=a.y,_t.angle=a.rotation,_t.x+=10*Math.cos(_t.angle),_t.y+=10*Math.sin(_t.angle);break}}ln=!1}))}function he(e){t("name").value=e.name;var n=e.w;t("roomW").value=e.w,oe=n;var o=e.h;t("roomH").value=e.h,ae=o,ie=[];for(var a=e.tiles.split(","),i=0;i<o;i++){for(var r=[],s=0;s<n;s++){var l=(p=a[s+i*n].split(".")).length;r.push(new(Re[Be[parseInt(p[0])]])(s,i,parseInt(p[0]),l>1?parseInt(p[1]):0,l>2?parseInt(p[2]):0))}ie.push(r)}re=[];var c=e.objects.split(",");if(c.length>0&&c[0].length>0)for(var h=0,u=c.length;h<u;h++){var p=c[h].split("~");re.push(new(_e[Ye[parseInt(p[2])]])(parseInt(p[0])+.5,parseInt(p[1])+.5,parseInt(p[2]),parseInt(p[3]),parseInt(p[4]),p[5]))}}function ue(){te=[];for(var t=[],e=[],n=0;n<ae;n++){for(var o=[],a=[],i=0;i<oe;i++)o.push(ie[n][i].layer===Ue.wall),a.push(!1);t.push(o),e.push(a)}for(n=0;n<ae;n++)for(i=0;i<oe;i++)if(!e[n][i]&&t[n][i]){for(var r=i;r<oe&&t[n][r];)r++;r--;for(var s=n,l=!0;s<ae&&t[s][r]&&l;){s++;for(var c=r;c>-1&&t[s][c];)c--;c+1!==i&&(l=!1,s--)}for(var h=n;h<s+1;h++)for(var u=i;u<r+1;u++)e[h][u]=!0;var p=(i+r+1)/2,d=(n+s+1)/2,f=r-i+1,g=s-n+1;te.push({x:16*p,y:16*d,w:16*f,h:16*g})}}var pe=!1,de={type:"tile",ID:0,variance:0,rotation:0,menuPos:{x:0,y:1},objectIndex:-1},fe="pen",ge={x:0,y:0},ye=!1,me={states:[],pos:-1,lastStep:"forward",lastActionWasEdit:!1,bufferSize:200},ve=!1;function xe(n){var o;if(n&&(J.cvs.style.cursor="none",pe||(!function(){for(var n=0,o=e("tr"),a=0;a<Be.length;a++){(i=e("button")).id="t"+a,i.xPos=n,i.yPos=t("buildTable").childNodes.length,i.onclick=function(){de.menuPos.x=this.xPos,de.menuPos.y=this.yPos,Ee(parseInt(this.id.slice(1)))},o.appendChild(De(i,yt[Re[Be[a]].prototype.imageName+"0"].spr.src,Re[Be[a]].prototype.layer?"#320738":"#08403a")),10===++n&&(t("buildTable").appendChild(o),o=e("tr"),n=0)}for(a=0;a<Ye.length;a++){var i;(i=e("button")).id="o"+a,i.xPos=n,i.yPos=t("buildTable").childNodes.length,i.onclick=function(){de.menuPos.x=this.xPos,de.menuPos.y=this.yPos,Te(parseInt(this.id.slice(1)))},o.appendChild(De(i,yt[_e[Ye[a]].prototype.imageName+"0"].spr.src,"#265917")),10===++n&&(t("buildTable").appendChild(o),o=e("tr"),n=0)}t("buildTable").appendChild(o),t("build").style.visibility="visible"}(),pe=!0),t("build").style.display="block",t("hideShow").style.display="block",t("object").style.display="block",de.objectIndex=-1,we()),I[w.BACKSLASH]&&(J.cvs.style.cursor="crosshair",t("build").style.display="none",t("hideShow").style.display="none",t("object").style.display="none",o=cn.OVERWORLD,gn=o,ln=!0,fn=cn.LOADING,He(),ue()),-1===de.objectIndex)Se.innerHTML="";else if(sn%10==0)for(var i=new _e[Ye[re[de.objectIndex].objectID]](0,0,0,0,0,"").metaArguments.length,r=0;r<i;r++){var s=t("objectMeta"+r);re[de.objectIndex].meta[s.labelName]=parseInt(s.value).toString().length===s.value.length?parseInt(s.value):s.value}ye=t("randAngle").checked;var l=t("tableSelection").style;l.top=43*de.menuPos.y-2+"px",l.left=42*de.menuPos.x+"px",I[w.UP]&&Ie(0,-1)&&(de.menuPos.y--,ke()),I[w.DOWN]&&Ie(0,1)&&(de.menuPos.y++,ke()),I[w.LEFT]&&Ie(-1,0)&&(de.menuPos.x--,ke()),I[w.RIGHT]&&Ie(1,0)&&(de.menuPos.x++,ke());var c=t("buildVariations").children[0];if(void 0!==c){r=1;for(var h=c.children.length;r<10&&r<=h;r++)I[w[r+""]]&&c.children[r-1].children[0].onclick()}if(A[w.a]&&v(-10/Y.zoom,0),A[w.d]&&v(10/Y.zoom,0),A[w.w]&&v(0,-10/Y.zoom),A[w.s]&&v(0,10/Y.zoom),T&&(!(T<0)||Y.zoom>1)){var u=1;T<0&&(u=-1);var p=1-Y.zoom/(Y.zoom+u),d=a();Y.x-=(P.x-G/2)*p,Y.y-=(P.y-$/2)*p,Y.zoom+=u}if(I[w.q]&&--de.rotation<0&&(de.rotation=3),I[w.e]&&++de.rotation>3&&(de.rotation=0),I[w.x]&&(fe="pen"),I[w.c]&&(fe="bucket"),(I[w.v]||I[w.ESCAPE])&&(fe="pointer"),I[w.ESCAPE]&&(t("enemyTable").style.display="none",de.objectIndex=-1,Se.innerHTML=""),(I[w.BACKSPACE]||I[w.DELETE]&&de.objectIndex>-1)&&(re.splice(de.objectIndex,1),de.objectIndex--,Me()),ie.length>0){switch(I[w.SHIFT]&&m(8*(oe-1),8*(ae-1)),(d=a()).x=Dt(Nt(d.x)/16,0,oe-1),d.y=Dt(Nt(d.y)/16,0,ae-1),k[0]&&we(),I[w.z]&&me.pos>-1&&(me.lastActionWasEdit?me.states.push(JSON.stringify(le())):"forward"===me.lastStep&&me.pos--,he(JSON.parse(me.states[me.pos])),me.pos--,me.lastStep="back",me.lastActionWasEdit=!1,de.objectIndex=re.length-1,Me()),I[w.y]&&me.pos<me.states.length-1&&("back"===me.lastStep&&me.pos++,me.pos++,he(JSON.parse(me.states[me.pos])),me.lastStep="forward",me.lastActionWasEdit=!1,de.objectIndex=re.length-1,Me()),fe){case"pen":if(E[0]&&(ge.x!==d.x||ge.y!==d.y)||k[0]){if(z(d,ge)>1)for(var f=Math.min(ge.x,d.x),g=Math.max(ge.x,d.x),y=Math.min(ge.y,d.y),x=Math.max(ge.y,d.y),b=y;b<=x;b++)for(var C=f;C<=g;C++)Ae(C,b,ge.x,ge.y,d.x,d.y)<=.5&&be(C,b);be(d.x,d.y)}break;case"bucket":if(k[0]){var S=oe,M=ae,N=t("fillType").value,D=ie[d.y][d.x].data,L=`${de.ID}.${de.variance}.${de.rotation}`;if("id"===N&&(D=D.split(".")[0]),D!==L){var j=[];j.push([d.x,d.y]);var H=[],O=[];for(b=0;b<M;b++){var B=[],F=[];for(C=0;C<S;C++)B.push(!1),"id"===N?F.push(ie[b][C].data.split(".")[0]):F.push(ie[b][C].data);H.push(B),O.push(F)}for(S--,M--;j.length>0;){var U=j.pop();H[U[1]][U[0]]||(O[U[1]][U[0]]=L,be(U[0],U[1]),H[U[1]][U[0]]=!0,U[1]<M&&O[U[1]+1][U[0]]===D&&j.push([U[0],U[1]+1]),U[0]<S&&O[U[1]][U[0]+1]===D&&j.push([U[0]+1,U[1]]),U[1]>0&&O[U[1]-1][U[0]]===D&&j.push([U[0],U[1]-1]),U[0]>0&&O[U[1]][U[0]-1]===D&&j.push([U[0]-1,U[1]]))}}}break;case"pointer":if(k[0]){var W=a();W.x+=8,W.y+=8;for(r=0,h=re.length;r<h;r++)if(R(re[r],W)){de.objectIndex=r,Me();break}}}if(k[2]){var V=ie[d.y][d.x];de.type="tile",Ee(V.tileID),de.rotation=Math.round(V.rotation/Math.PI*2),de.variance=V.variation}ge=d}}function be(t,e){var n=de.rotation;switch(ye&&(n=i(0,3)),de.type){case"tile":ie[e][t]=new Re[Be[de.ID]](t,e,de.ID,de.variance,n);break;case"object":de.objectIndex=re.length,re.push(new _e[Ye[de.ID]](t+.5,e+.5,de.ID,de.variance,n)),Me()}}function we(){me.pos<me.states.length-1&&(me.states.length=me.pos+1),me.states.push(JSON.stringify(le())),me.pos++,me.lastStep="forward",me.lastActionWasEdit=!0,me.states.length>me.bufferSize&&(me.states.shift(),me.pos--)}function Ie(e,n){if(de.menuPos.y+n===0)return!1;var o=t("buildTable").children[de.menuPos.y+n];return void 0!==o&&void 0!==o.children[de.menuPos.x+e]}function Ae(t,e,n,o,a,i){var r,s,l=a-n,c=i-o,h=l*l+c*c,u=-1;0!=h&&(u=((t-n)*l+(e-o)*c)/h),u<0?(r=n,s=o):u>1?(r=a,s=i):(r=n+u*l,s=o+u*c);var p=t-r,d=e-s;return Math.sqrt(p*p+d*d)}function ke(){t("buildTable").children[de.menuPos.y].children[de.menuPos.x].children[0].onclick()}function Ee(n){de.type="tile",de.ID=n,de.variance=0,de.rotation=0,de.menuPos.x=n%10,de.menuPos.y=Math.floor(n/10)+1;for(var o=e("tr"),a=Re[Be[n]],i=0,r=a.prototype.typesAmount;i<r;i++){var s=e("button");s.id="v"+i,s.style="width: 34px; height: 34px; padding:0;",s.onclick=function(){de.variance=parseInt(this.id.slice(1))},o.appendChild(De(s,yt[a.prototype.imageName+i].spr.src))}t("buildVariations").innerHTML="",t("buildVariations").appendChild(o);for(var l=Be[n],c=`id: ${n}\n type: tile\n layer: ${a.prototype.layer}\n name: ${l}\n merges with: `,h=a.prototype.mergesWith,u=0;u<h.length;u++)c+=Be[h[u]]+", ";t("buildInfo").innerText=c}function Te(n){de.type="object",de.ID=n,de.variance=0,de.rotation=0;for(var o=e("tr"),a=_e[Ye[n]],i=0,r=a.prototype.typesAmount;i<r;i++){var s=e("button");s.id="v"+i,s.style="width: 34px; height: 34px; padding:0;",s.onclick=function(){de.variance=parseInt(this.id[1])},o.appendChild(De(s,yt[a.prototype.imageName+i].spr.src))}t("buildVariations").innerHTML="",t("buildVariations").appendChild(o);for(var l=`id: ${n}\n type: object\n name: ${Ye[n]}\n arguments: `,c=0,h=a.prototype.metaArguments.length;c<h;c++)l+=a.prototype.metaArguments[c][0]+", ";t("buildInfo").innerText=l}t("selectPen").onclick=function(){fe="pen"},t("selectBucket").onclick=function(){fe="bucket"},t("selectPointer").onclick=function(){fe="pointer"},t("hideShow").onclick=function(){"hide"===this.innerText?(t("build").style.display="none",this.innerText="show",this.style.left="10px"):(t("build").style.display="block",this.innerText="hide",this.style.left="475px")},t("newRoom").onclick=function(){0!==ie.length&&we(),ie=[],re=[];for(var e=parseInt(t("roomW").value),n=parseInt(t("roomH").value),o=0;o<n;o++){for(var a=[],i=0;i<e;i++)a.push(new Ke(i,o,0,0,0));ie.push(a)}de.objectIndex=-1,m(8*e,8*n)},t("help").onclick=function(){var e=t("helpDiv").style;e.display="block"===e.display?"none":"block"};var Pe,Ce,Se=t("object");function Me(){if(-1!==de.objectIndex){Se.innerHTML="";for(var t=new _e[Ye[re[de.objectIndex].objectID]](0,0,0,0,0,"").metaArguments,e=0;e<t.length;e++)Ne(t[e][0],t[e][1],e,re[de.objectIndex].meta[t[e][0]])}}function Ne(n,o,a,i){var r,s=e("span");switch(s.innerText=n,s.style.paddingRight="20px",Se.appendChild(s),o){case tn.string:(r=e("input")).type="text",r.value=void 0===i?"":i;break;case tn.number:(r=e("input")).type="number",r.value=void 0===i?"0":i;break;case tn.room:(r=e("select")).innerHTML=Pe.innerHTML,r.value=void 0===i?"0":i;break;case tn.enemy:(r=e("button")).onclick=function(){t("enemyTable").style.display="none"===t("enemyTable").style.display?"block":"none",Ce=r},r.innerText="select",r.value=void 0===i?"0":i}r.id="objectMeta"+a,r.labelName=n,r.onfocus=function(){ve=!0},r.onblur=function(){ve=!1},Se.appendChild(r);var l=e("br");Se.appendChild(l)}function De(t,n,o="#00000000"){var a=e("td");a.style.backgroundColor=o,t.style="width: 34px; height: 34px; padding:0;";var i=e("img");return i.style.width="32px",i.style.height="32px",i.src=n,t.appendChild(i),a.appendChild(t),a}t("save").onclick=function(){var n=le(),o=e("a");o.download=t("name").value;var a=new Blob([JSON.stringify(n)],{type:"application/json"});o.href=URL.createObjectURL(a);var i=document.createEvent("MouseEvents");i.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),o.dispatchEvent(i)},t("fileUpload").onchange=function(){void 0!==t("fileUpload").files[0]&&(0!==ie.length&&we(),fetch(URL.createObjectURL(t("fileUpload").files[0])).then(t=>t.json().then(t=>{he(t),de.objectIndex=-1,Me(),m(0,0)})))};var Le=["test.json","a.json","village.json"],je="assets/rooms/";function He(){Y.x=0,Y.y=0,Y.angle=0,Y.zoom=1,ot=8,at=8,nt=!0;for(var t=[[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1],[0,-1]],n=Object.keys(se),o=0;o<n.length;o++)se[n[o]]=e("canvas"),se[n[o]].width=16*oe,se[n[o]].height=16*ae;var a=se.ground.getContext("2d");F=a;for(var i=0;i<ae;i++)for(var r=0;r<oe;r++)ie[i][r].layer===Ue.ground&&ie[i][r].draw();var s=a.getImageData(0,0,16*oe,16*ae);for(i=0;i<ae;i++)for(r=0;r<oe;r++){var l=ie[i][r].mergesWith;i+1<ae&&l.includes(ie[i+1][r].tileID)&&Oe(s,ie[i][r],16*r,16*(i+1),"bottom"),i-1>-1&&l.includes(ie[i-1][r].tileID)&&Oe(s,ie[i][r],16*r,16*(i-1),"top"),r+1<oe&&l.includes(ie[i][r+1].tileID)&&Oe(s,ie[i][r],16*(r+1),16*i,"right"),r-1>-1&&l.includes(ie[i][r-1].tileID)&&Oe(s,ie[i][r],16*(r-1),16*i,"left")}a.putImageData(s,0,0);var c=se.walls.getContext("2d");F=c;for(i=0;i<ae;i++)for(r=0;r<oe;r++)ie[i][r].layer===Ue.wall&&ie[i][r].draw();function h(t,e){return t<oe&&t>-1&&e<ae&&e>-1}for(i=0;i<ae;i++)for(r=0;r<oe;r++)if(ie[i][r].layer===Ue.wall){var p="";for(o=0;o<8;o++){var d=t[o];h(r+d[0],i+d[1])?p+=ie[i+d[1]][r+d[0]].layer===Ue.wall?"1":"0":p+="1"}u({spr:ze[p],drawLimitSize:8},16*r,16*i)}ot=0,at=0;var f=se.objects.getContext("2d");F=f;o=0;for(var g=re.length;o<g;o++)re[o].draw();ln=!1}function Oe(t,e,n,o,a){var r=4*t.width,s=4*n,l=o*r,c=t.data,h=We[e.tileID][e.variation].data;function u(t,e){worldPosition=e*r+l+4*t+s,tilePosition=64*e+4*t,c[worldPosition]=h[tilePosition],c[worldPosition+1]=h[tilePosition+1],c[worldPosition+2]=h[tilePosition+2],c[worldPosition+3]=h[tilePosition+3]}switch(a){case"top":for(var p=15;p>9;p--)for(var d=0;d<16;d++)0===i(0,(16-p)/2)&&u(d,p);break;case"bottom":for(p=0;p<6;p++)for(d=0;d<16;d++)0===i(0,p/2)&&u(d,p);break;case"right":for(p=0;p<16;p++)for(d=0;d<6;d++)0===i(0,d/2)&&u(d,p);break;case"left":for(p=0;p<16;p++)for(d=15;d>9;d--)0===i(0,(16-d)/2)&&u(d,p)}}var ze={};var Be=["TileGrass","TilePath","TileBrickPath","WallBrick","WallHouse"],Re={};const Ge=0,$e=1,Fe=2,Ue={ground:0,wall:1};var We=[];class Ve{constructor(t,e,n,o,a=0){this.x=16*t,this.y=16*e,this.tileID=n,this.variation=o,this.rotation=a*Math.PI/2}get data(){return 0!==this.rotation?`${this.tileID}.${this.variation}.${~~(this.rotation/Ht)}`:0!==this.variation?`${this.tileID}.${this.variation}`:""+this.tileID}}Ve.prototype.w=16,Ve.prototype.h=16,Ve.prototype.imageName="debug",Ve.prototype.typesAmount=1,Ve.prototype.mergesWith=[],Ve.prototype.effect=Ge,Ve.prototype.layer=Ue.ground,Ve.prototype.draw=function(){u(yt[`${this.imageName}${this.variation}`],this.x,this.y,this.rotation)},Re.Tile=Ve;class Qe extends Ve{constructor(t,e,n,o,a=0){super(t,e,n,o,a)}}Qe.prototype.effect=$e,Qe.prototype.layer=Ue.wall,Re.BaseWall=Qe;class qe extends Ve{constructor(t,e,n,o,a=0){super(t,e,n,o,a)}}qe.prototype.imageName="brickPath",qe.prototype.typesAmount=3,qe.prototype.effect=Fe,Re.TileBrickPath=qe;class Ke extends Ve{constructor(t,e,n,o,a=0){super(t,e,n,o,a)}}Ke.prototype.imageName="grass",Ke.prototype.typesAmount=2,Ke.prototype.mergesWith=[0,1,3],Re.TileGrass=Ke;class Xe extends Ve{constructor(t,e,n,o,a=0){super(t,e,n,o,a)}}Xe.prototype.imageName="path",Xe.prototype.effect=Fe,Xe.prototype.mergesWith=[3],Re.TilePath=Xe;class Ze extends Qe{constructor(t,e,n,o,a=0){super(t,e,n,o,a)}}Ze.prototype.imageName="brick",Ze.prototype.typesAmount=4,Re.WallBrick=Ze;class Je extends Qe{constructor(t,e,n,o,a=0){super(t,e,n,o,a)}}Je.prototype.imageName="house",Je.prototype.typesAmount=3,Re.WallHouse=Je;var Ye=["HouseEntrance","HouseSmokeStack","Spawner"],_e={},tn={number:0,string:1,enemy:2,room:3};class en{constructor(t,e,n,o,a=0,i=""){this.x=16*t,this.y=16*e,this.objectID=n,this.variation=o,this.rotation=a*Math.PI/2,this.meta={};for(var r=i.split("@"),s=0;s<this.metaArguments.length;s++){void 0===r[s]&&(r[s]=0);var l=r[s].length;l>0&&(parseInt(r[s]).toString().length===l?this.meta[this.metaArguments[s][0]]=parseInt(r[s]):this.meta[this.metaArguments[s][0]]=r[s])}}get data(){for(var t="",e=0;e<this.metaArguments.length;e++)t+=this.meta[this.metaArguments[e][0]]+"@";return t=t.substring(0,t.length-1),`${this.x/16-.5}~${this.y/16-.5}~${this.objectID}~${this.variation}~${~~(this.rotation/Ht)}~${t}`}}en.prototype.imageName="debug",en.prototype.typesAmount=1,en.prototype.metaArguments=[],en.prototype.w=16,en.prototype.h=16,en.prototype.draw=function(){u(yt[`${this.imageName}${this.variation}`],this.x,this.y,this.rotation)},en.prototype.update=function(){return!1},en.prototype.initialize=function(){},_e.BaseObject=en;class nn extends en{constructor(t,e,n,o,a=0,i=""){super(t,e,n,o,a,i)}}nn.prototype.imageName="houseEntrance",nn.prototype.metaArguments=[["room",tn.room],["entranceID",tn.string]],nn.prototype.update=function(){return z(this,_t)<8&&(_t.angle=r(_t,this),Bt={room:this.meta.room,entranceID:this.meta.entranceID,walkTime:20},Ft(0)),!1},_e.HouseEntrance=nn;class on extends en{constructor(t,e,n,o,a=0,i=""){super(t,e,n,o,a,i)}}on.prototype.imageName="spawner",on.prototype.metaArguments=[["enemyType",tn.enemy],["spawnCap",tn.number],["framesBetweenSpawns",tn.number],["range",tn.number]],on.prototype.update=function(){return sn%this.meta.framesBetweenSpawns==0&&console.log("spawn"),!1},on.prototype.draw=function(){var t,e,n,o;ln||(u(yt[`${this.imageName}${this.variation}`],this.x,this.y,this.rotation),t=this.x,e=this.y,n=this.meta.range,o="#ffffff",F.beginPath(),F.arc(t+Y.x+ot,e+Y.y+at,n,0,2*Math.PI,!1),F.strokeStyle=o,F.stroke())},_e.Spawner=on;class an extends en{constructor(t,e,n,o,a=0,i=""){super(t,e,n,o,a,i)}}an.prototype.imageName="smokeStack",an.prototype.update=function(){return!1},_e.HouseSmokeStack=an,dt=["assets/images/",["tiles/","debug0.png","grass0.png","grass1.png","path0.png","brick0.png","brick1.png","brick2.png","brick3.png","brickPath0.png","brickPath1.png","brickPath2.png","house0.png","house1.png","house2.png"],["objects/","tree0.png","tree1.png","link0.png","link1.png","houseEntrance0.png","smokeStack0.png","spawner0.png"],["UI/slot","Accessory.png","Weapon.png","Select.png","Frame.png","Head.png","Body.png","Pants.png","Boots.png","Hand.png"],["entities/",["player","1.png","2.png","3.png","4.png","5.png"],["enemies/","slime0.png","angryHedge0.png"]],"preview0.png","tempPlayer.png","tempEnemy00.png","buildPen.png","buildBucket.png","buildPointer.png","shadowSide.png","shadowCorner.png"],mt=["assets/audio/"];var rn=0,sn=0,ln=!0;const cn={TITLE:0,LOADING:1,OVERWORLD:2,FIGHTING:3,CUTSCENE:4,BUILDING:5};var hn,un,pn,dn,fn=cn.LOADING,gn=cn.OVERWORLD,yn=!1;function mn(){switch(un=fn!=hn,hn=fn,fn){case cn.TITLE:break;case cn.OVERWORLD:ee();break;case cn.FIGHTING:break;case cn.LOADING:un&&(t("load").style.display="block"),ln||(t("load").style.display="none",fn=gn);break;case cn.CUTSCENE:un&&(Rt=0),$t[Gt].update(),Rt++;break;case cn.BUILDING:ve||xe(un),(k[0]||I[w.ESCAPE])&&([].forEach.call(document.getElementsByTagName("button"),t=>{t.blur()}),[].forEach.call(document.getElementsByTagName("select"),t=>{t.blur()}),[].forEach.call(document.getElementsByTagName("input"),t=>{t.blur()}))}sn++}function vn(){switch(fn){case cn.TITLE:break;case cn.OVERWORLD:ne();break;case cn.FIGHTING:case cn.LOADING:break;case cn.CUTSCENE:ne(),$t[Gt].draw();break;case cn.BUILDING:!function(){for(var t=0;t<ae;t++)for(var e=0;e<oe;e++)ie[t][e].draw();ot=-8,at=-8;for(var n=0,o=re.length;n<o;n++)re[n].draw();if(ot=0,at=0,ie.length>0)if("pointer"===fe){if(de.objectIndex>-1&&de.objectIndex<re.length){var a=re[de.objectIndex];new _e[Ye[a.objectID]](a.x/16-.5,a.y/16-.5,a.objectID,a.variation,-a.rotation+Math.cos(rn/10)/5).draw()}}else"tile"===de.type?new Re[Be[de.ID]](ge.x+Math.cos(rn/10)/10,ge.y+Math.sin(rn/10)/10,de.ID,de.variance,de.rotation).draw():new _e[Ye[de.ID]](ge.x+Math.cos(rn/10)/10,ge.y+Math.sin(rn/10)/10,de.ID,de.variance,de.rotation).draw()}()}rn++}_=60,J.cvs=t("game"),J.cvs.width=document.body.clientWidth,J.cvs.height=document.body.offsetHeight<window.innerHeight?window.innerHeight:document.body.offsetHeight,G=J.cvs.width,$=J.cvs.height,J.ctx=J.cvs.getContext("2d",{alpha:!1}),J.cvs.onmousedown=function(){tt||(function(){var t="";function e(n,o){let a="";for(let i=0;i<n.length;i++){if("string"==typeof n[i])if(0==i)t+=n[i],a=n[i];else if("image"==o){let e=t+n[i];ft.push(e);let o=new Image;o.src=e,o.onerror=function(){console.warn(rt+" "+this.src+" was not found")},o.onload=function(){l(e,o)},gt.push(o)}else"sound"==o&&(vt.push(t+n[i]),c(t+n[i]));"object"==typeof n[i]&&e(n[i],o)}t=t.slice(0,t.length-a.length)}Et=new AudioContext,(Tt=Et.createGain()).connect(Et.destination),(Pt=Et.createGain()).connect(Et.destination),e(dt,"image"),e(mt,"sound"),(X=new Image).src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAC4jAAAuIwF4pT92AAAAf0lEQVQ4jc2SuxHAIAxDbY4pMpHmyJSeKGuQKpyj2Hy6qETPQvhQCWRmDRfeZ4cJAGW28mAUyL4Pqmx2nfK+zaR59glRHo5qZi0BaPHmbDhiyuzdsza9wcrtEVtG4Ip+FLCzTM+WneWxPv9gpQUzmhncLPOHUCYfHr4/C4r2dQPfhkeIbjeYWgAAAABJRU5ErkJggg==",Z=new Audio("data:audio/x-wav;base64,UklGRowBAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YWgBAADa/6T/2/+S/x//pP769Xr4fPh5+H34evh7+Pv6gf18/QIAhQcIDxUZFR4VHhgeEx6TFgkPCgqAAnz49/X18HLu7ubo4eXc5dzj3Gjf5+Fr5G7pce759YECiwwRFBQZlxuXG5cbFRmTFo8RCAoAAPz69/X08G7udO5s7vz1dvj++nv9gP3+/wEAgwKBAogHkBEpLUNG1lzqcPV683r4eu51ZmnVV7w+qypy88fDoKAXlAqKBoUAgIeHlpYsrTu87Ot9/ZIRGxkoKDEtqionIxgZiwfj5lnaz9JN0E3QV9pd3+Tm9fUBAAQFBwWNDBEPFxSYFpsWEA9+/fP1dfNt83bz8fX9+gQFkAwPDxQPEQ+IBwIAdfjv8OLm2+HX3Nrh4+bm63n4BAUUDx0ZqyCrJSkelBGEAnb4a+5a5Njcztxc31jkZunx9QgFGhQfGa0gqCCuIKkgpRsaFIsHdfhj6dfh0NzM19Th6es=");let n=G/2-100,o=$/2-100;ut.screenSize={x:n+160,y:o+12,w:50,h:20},ut.sfx={x:n+125,y:o+40,w:120,h:20},ut.bmg={x:n+125,y:o+70,w:120,h:20},s()}(),tt=!0)},n("buffer1"),n("buffer2"),J.ctx.imageSmoothingEnabled=!1,J.buffer1ctx.imageSmoothingEnabled=!1,J.buffer2ctx.imageSmoothingEnabled=!1,U=Math.max(J.cvs.width,J.cvs.height),K=U-Math.min(J.cvs.width,J.cvs.height),G=J.cvs.width,$=J.cvs.height,(pn=e("style")).innerHTML='\n    @font-face {\n        font-family: "pixelmix";\n        src: url(assets/pixelmix.ttf) format("truetype");\n        font-weight: 900;\n        font-style: normal;\n    }\n    html {font-family: "pixelmix" !important; font-size: 16px;}\n    ',document.head.appendChild(pn),J.ctx.textBaseline="hanging",J.ctx.textAlign="left",function(){var t=e("style");t.id="gamejsstyle",document.head.appendChild(t);var n=e("meta");n.setAttribute("charset","utf-8"),document.head.appendChild(n)}(),dn=J.cvs,window.addEventListener("keydown",M),window.addEventListener("keyup",N),dn.addEventListener("mousedown",D),dn.addEventListener("mouseup",L),dn.addEventListener("mousemove",j),dn.addEventListener("contextmenu",H),dn.addEventListener("wheel",O),F=J.ctx,requestAnimationFrame((function t(){J.cvs.width=document.body.clientWidth,J.cvs.height=(document.body.offsetHeight<window.innerHeight?window.innerHeight:document.body.offsetHeight)-1,G=J.cvs.width,$=J.cvs.height,F.fillStyle="#101010",F.fillRect(0,0,G,$),f(G/2,$/2,27,"#066312"),f(G/2,$/2,23,"#149124"),g(G/2,$/2,[{x:-7,y:-15},{x:-7,y:15},{x:15,y:0}],"#47f55d"),tt||requestAnimationFrame(t)}))