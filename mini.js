function e(e){var t=document.createElement("canvas");t.id=e,t.width=R.cvs.width,t.height=R.cvs.height,t.style="image-rendering:pixelated;image-rendering: crisp-edges;display:none",document.body.appendChild(t),R[e+"cvs"]=document.getElementById(e),R[e+"ctx"]=R[e+"cvs"].getContext("2d")}function t(){if(0===j)return{x:x.x-G.x,y:x.y-G.y};if(1===j)return{x:(x.x-(e=R.cvs.width/2))/G.zoom+e-G.x,y:(x.y-(t=R.cvs.height/2))/G.zoom+t-G.y};var e,t,n,o,i={x:(x.x-(e=R.cvs.width/2))/G.zoom+e-G.x,y:(x.y-(t=R.cvs.height/2))/G.zoom+t-G.y},a={x:E/2-G.x,y:I/2-G.y},r=Math.atan2((o=i).y-(n=a).y,o.x-n.x)-G.angle,c=w(a,i);return{x:a.x+Math.cos(r)*c,y:a.y+Math.sin(r)*c}}function n(){Object.keys(ee).length==J.length&&te.length==ae?(function(){try{input}catch(e){$=!1}requestAnimationFrame(ue),setInterval(de,1e3/Q),$&&setInterval(fe,4)}(),J=[],te=[],_=[]):(k.fillStyle="#2d2d2d",k.fillRect(0,0,E,I),h(`audio:   ${ae}/${te.length}`,10,30,"white",2),h(`sprites: ${Object.keys(ee).length}/${J.length}`,10,10,"white",2),k.setTransform(1,0,0,1,Math.round(E/2),Math.round(I/2)),k.rotate(O),O+=.1,k.drawImage(H,-8,-8),k.setTransform(1,0,0,1,0,0),requestAnimationFrame(n))}function o(e,t){let n,o=e.lastIndexOf(".");for(let t=o-1;ce.includes(e[t]);t--)n=t;let i=e.slice(n,o);ee[i]={spr:t,drawLimitSize:Math.max(t.width,t.height)/2}}function i(e){let t,n=e.lastIndexOf(".");for(let o=n-1;ce.includes(e[o]);o--)t=o;let o=e.slice(t,n);ne[o]={nodes:[],volNodes:[],src:e,type:"sfx",volume:1},ne[o].nodes=[1];let i=new Audio;i.onerror=function(){console.warn(U+" "+e+" was not found")},i.src=e,i.preload="auto",i.addEventListener("canplaythrough",(function(){ae++}),!1),ne[o].nodes.push(i);let a=se.createMediaElementSource(i),r=se.createGain();a.connect(r),r.connect(le),oe.push(a),ie.push(r),ne[o].volNodes.push(ie.length-1)}function a(){V&&p[0]&&(A(Y.sfx,x)&&(re.sfx=(x.x-(Y.sfx.x-60))/120),A(Y.bmg,x)&&(re.bgm=(x.x-(Y.bmg.x-60))/120)),x.x>E-32&&x.y<32?(g[0]&&(S.play(),K=!0,V=!V),X=25):X=0,x.x<E-32&&x.x>E-64&&x.y<32?(Z=25,g[0]&&(S.play(),K=!K)):Z=0}function r(e,t,n,o=0,i=1,a=1){var r=e.drawLimitSize;if(t+r>M&&t-r<C&&n+r>P&&n-r<z||L){let r=e.spr;0===o&&1===i&&1===a?k.drawImage(r,Math.round(t+G.x+N-r.width/2),Math.round(n+G.y+q-r.height/2)):(k.setTransform(i,0,0,a,Math.round(t+G.x+N),Math.round(n+G.y+q)),k.rotate(o),k.drawImage(r,Math.round(-r.width/2),Math.round(-r.height/2)),k.setTransform(1,0,0,1,0,0))}}function c(e,t,n,o,i){k.fillStyle=i,k.fillRect(e-n/2+G.x+N,t-o/2+G.y+q,n,o)}function s(e,t,n,o){k.beginPath(),k.arc(e+G.x+N,t+G.y+q,n,0,2*Math.PI,!1),k.fillStyle=o,k.fill()}function l(e,t,n,o){e+=G.x+N,t+=G.y+q,k.fillStyle=o,k.beginPath(),k.moveTo(e+n[0].x,t+n[0].y);for(let o=1,i=n.length;o<i;o++)k.lineTo(e+n[o].x,t+n[o].y);k.fill()}function h(e,t,n,o="black",i=1,a=E){e=""+e,k.fillStyle=o,k.font=8*Math.round(i)+"px pixelmix";var r=e.split("\n");for(let e=0;e<r.length;e++)if(k.measureText(r[e]).width>a){var c=r[e].split(" "),s="",l=0;r.splice(e,1);for(let t=0;t<c.length;t++)k.measureText(s+c[t]+" ").width<a?s+=c[t]+" ":(0==t&&(s+=c[t]),r.splice(e+l,0,s),l++,s="",c.splice(0,0==t?1:t),t=-1);0!=s.length&&r.splice(e+l,0,s)}for(let e=0;e<r.length;e++)k.fillText(r[e],t+G.x+N,n+G.y+q+(8*(e+(j?1:0))*i+i*e))}function u(e,t){G.x-=t*Math.sin(G.angle),G.y-=t*Math.cos(G.angle),G.x-=e*Math.sin(G.angle+1.57079632),G.y-=e*Math.cos(G.angle+1.57079632)}function d(e,t,n,o,i,a){a.setTransform(o,0,0,o,e,t),a.rotate(n),a.drawImage(i,-i.width/2,-i.height/2),a.setTransform(1,0,0,1,0,0)}var f=[],m=[],g=[],p=[],y=0,x={x:0,y:0};function v(){for(var e=0;e<f.length;e++)f[e]&&(f[e]=0);for(e=0;e<g.length;e++)g[e]&&(g[e]=0);y=0}function w(e,t){let n=t.x-e.x,o=t.y-e.y;return Math.sqrt(n*n+o*o)}function A(e,t){return e.x+e.w/2>=t.x&&e.x-e.w/2<=t.x&&e.y+e.h/2>=t.y&&e.y-e.h/2<=t.y}var E,I,k,B,M,C,P,z,T,H,S,F,D,R={cvs:null,ctx:null,buffer1cvs:null,buffer1ctx:null,buffer2cvs:null,buffer2ctx:null},G={zoom:1,angle:0,x:0,y:0},Q=60,W=!1,j=0,L=!1,N=0,q=0,$=!0,U="🐛",O=0,X=0,Z=0,V=!1,Y={},K=!1,J=[],_=[],ee={},te=[],ne={},oe=[],ie=[],ae=0,re={sfx:1,bgm:1};cursor={sprite:null,alignment:1,show:!0},mouseOnCanvas=!1;const ce="qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM1234567890_-. ";var se,le,he;function ue(){R.cvs.width=document.body.clientWidth,R.cvs.height=(document.body.offsetHeight<window.innerHeight?window.innerHeight:document.body.offsetHeight)-1,E=R.cvs.width,I=R.cvs.height,document.getElementById("gamejsstyle"),function(){switch(G.zoom<1&&(G.zoom=1),j=0!=G.angle?2:1!=G.zoom?1:0){case 0:k=R.ctx;break;case 1:k=R.buffer1ctx;break;case 2:k=R.buffer2ctx}}(),function(){T=(B=Math.max(R.cvs.width,R.cvs.height))-Math.min(R.cvs.width,R.cvs.height);var e=B/G.zoom,t=e+e/2;R.buffer2cvs.width=t,R.buffer2cvs.height=t,2===j?(N=(R.buffer2cvs.width-R.cvs.width)/2,q=(R.buffer2cvs.height-R.cvs.height)/2):(N=0,q=0),R.ctx.imageSmoothingEnabled=!1,R.buffer1ctx.imageSmoothingEnabled=!1,R.buffer2ctx.imageSmoothingEnabled=!1}(),R.ctx.clearRect(0,0,R.cvs.width,R.cvs.height),R.buffer1ctx.clearRect(0,0,R.buffer1cvs.width,R.buffer1cvs.height),R.buffer2ctx.clearRect(0,0,R.buffer2cvs.width,R.buffer2cvs.height);var e=0;2==j&&(e=R.buffer2cvs.width-B),M=-G.x-(2==j?T:0)-e,C=-G.x+B+(2==j?T:0)+e,P=-G.y-(2==j?T:0)-e,z=-G.y+B+(2==j?T:0)+e,function(){switch(Ne){case Se:case De:case Re:case Fe:break;case Ge:!function(){for(var e=0,n=ye.length;e<n;e++)for(var o=0,i=ye[0].length;o<i;o++)ye[e][o].draw();if(ye.length>0){var a=t();switch(a.x=ge(me(a.x)/16,0,ye[0].length-1),a.y=ge(me(a.y)/16,0,ye.length-1),ve.type){case"tile":new ke[Ie[ve.ID]](a.x+Math.cos(He/10)/10,a.y+Math.sin(He/10)/10,ve.ID,ve.variance,ve.rotation).draw()}}}()}He++}(),1===j&&d(R.cvs.width/2,R.cvs.height/2,0,G.zoom,R.buffer1cvs,R.ctx),2===j&&(d(R.cvs.width/2,R.cvs.height/2,G.angle,1,R.buffer2cvs,R.buffer1ctx),d(R.cvs.width/2,R.cvs.height/2,0,G.zoom,R.buffer1cvs,R.ctx)),k=R.ctx,N=0,q=0;var n={x:G.x,y:G.y},o=j;G.x=0,G.y=0,j=0,L=!0;try{!function(){switch(Ne){case Se:case De:case Re:case Fe:break;case Ge:"pen"===be?r(ee.buildPen,x.x+16,x.y+16,0,2,2):r(ee.buildBucket,x.x+16,x.y,0,2,2)}}()}catch(e){}L=!1;let i=E/2-100,a=I/2-100;Y.sfx={x:i+125,y:a+40,w:120,h:20},Y.bmg={x:i+125,y:a+70,w:120,h:20},function(){let e={x:E-16,y:16};c(e.x,e.y,34,34,"#9c9c9c");let t=X+45;c(e.x,e.y,32,32,`rgb(${t},${t},${t})`),t=X+69;let n=`rgb(${t},${t},${t})`;c(e.x,e.y-6,26,4,n),c(e.x-6,e.y-6,4,8,n),c(e.x,e.y+6,26,4,n),c(e.x+11,e.y+6,4,8,n),e.x-=33,c(e.x,e.y,34,34,"#9c9c9c"),t=Z+45,c(e.x,e.y,32,32,`rgb(${t},${t},${t})`),t=Z+69,n=`rgb(${t},${t},${t})`,K?l(e.x,e.y,[{x:-7,y:-10},{x:-7,y:10},{x:10,y:0}],n):(c(e.x+6,e.y,6,20,n),c(e.x-6,e.y,6,20,n))}(),function(){if(V){let e={x:E/2-100,y:I/2-100};c(E/2,I/2,200,200,"#242424"),h("sfx",e.x+2,e.y+30,"white",2),b=Y.sfx,c(b.x,b.y,b.w,b.h-10,"#444444"),c(b.x-60+120*re.sfx,b.y,8,20,"#444444"),h("bmg",e.x+2,e.y+60,"white",2),b=Y.bmg,c(b.x,b.y,b.w,b.h-10,"#444444"),c(b.x-60+120*re.bgm,b.y,8,20,"#444444")}}(),cursor.sprite&&mouseOnCanvas?(cursor.alignment?R.ctx.drawImage(cursor.sprite.spr,x.x-Math.round(cursor.sprite.spr.width/2),x.y-Math.round(cursor.sprite.spr.height/2)):R.ctx.drawImage(cursor.sprite.spr,x.x,x.y),cursor.show=!1):cursor.show=!0,j=o,G.x=n.x,G.y=n.y,requestAnimationFrame(ue)}function de(){0==$&&a(),le.gain.value=re.sfx,he.gain.value=re.bgm,K||function(){switch(We=Ne!=Qe,Qe=Ne,Ne){case Se:case De:case Re:case Fe:break;case Ge:!function(e){if(e&&(xe||(function(){for(var e=0,t=document.createElement("tr"),n=0;n<Ie.length;n++){var o=document.createElement("td");o.style.backgroundColor=ke[Ie[n]].prototype.layer?"#320738":"#08403a";var i=document.createElement("button");i.id="t"+n,i.onclick=function(){Ae(parseInt(this.id[1]))};var a=document.createElement("img");a.style.width="32px",a.style.height="32px",a.src=ee[ke[Ie[n]].prototype.imageName+"0"].spr.src,i.appendChild(a),o.appendChild(i),t.appendChild(o),10==++e&&(document.getElementById("buildTable").appendChild(t),t=document.createElement("tr"))}document.getElementById("buildTable").appendChild(t),document.getElementById("build").style.visibility="visible"}(),xe=!0)),m[65]&&u(-5/G.zoom,0),m[68]&&u(5/G.zoom,0),m[87]&&u(0,-5/G.zoom),m[83]&&u(0,5/G.zoom),G.zoom+=y,f[81]&&--ve.rotation<0&&(ve.rotation=3),f[69]&&++ve.rotation>3&&(ve.rotation=0),f[90]&&(be="pen"),f[88]&&(be="bucket"),ye.length>0){var n=t();if(n.x=ge(me(n.x)/16,0,ye[0].length-1),n.y=ge(me(n.y)/16,0,ye.length-1),p[0]&&"pen"===be){if(w(n,pe)>1)for(var o=Math.min(pe.x,n.x),i=Math.max(pe.x,n.x),a=Math.min(pe.y,n.y),r=Math.max(pe.y,n.y),c=a;c<=r;c++)for(var s=o;s<=i;s++)Ee(s,c,pe.x,pe.y,n.x,n.y)<=.5&&we(s,c);we(n.x,n.y)}if(g[1]){var l=ye[n.y][n.x];ve.type="tile",Ae(l.tileID),ve.rotation=Math.round(l.rotation/Math.PI*2),ve.variance=l.variation}pe=n}}(We)}}(),0==$&&v()}function fe(){a(),K||input(),v()}function me(e){return 16*Math.round(e/16)}function ge(e,t,n){return Math.min(n,Math.max(t,e))}AudioContext=window.AudioContext||window.webkitAudioContext,document.getElementById("game").onmouseout=function(){mouseOnCanvas=!1},document.getElementById("game").onmouseover=function(){mouseOnCanvas=!0};var pe,ye=[],xe=!1,ve={type:"tile",ID:0,variance:0,rotation:0},be="pen";function we(e,t){switch(ve.type){case"tile":ye[t][e]=new ke[Ie[ve.ID]](e,t,ve.ID,ve.variance,ve.rotation)}}function Ae(e){ve.type="tile",ve.ID=e,ve.variance=0;for(var t=document.createElement("tr"),n=0,o=ke[Ie[e]].prototype.typesAmount;n<o;n++){var i=document.createElement("td"),a=document.createElement("button");a.id="v"+n,a.onclick=function(){ve.variance=parseInt(this.id[1])};var r=document.createElement("img");r.style.width="32px",r.style.height="32px",r.src=ee[ke[Ie[e]].prototype.imageName+n].spr.src,a.appendChild(r),i.appendChild(a),t.appendChild(i)}document.getElementById("buildVariations").innerHTML="",document.getElementById("buildVariations").appendChild(t)}function Ee(e,t,n,o,i,a){var r,c,s=i-n,l=a-o,h=s*s+l*l,u=-1;0!=h&&(u=((e-n)*s+(t-o)*l)/h),u<0?(r=n,c=o):u>1?(r=i,c=a):(r=n+u*s,c=o+u*l);var d=e-r,f=t-c;return Math.sqrt(d*d+f*f)}document.getElementById("selectPen").onclick=function(){be="pen"},document.getElementById("selectBucket").onclick=function(){be="pen"},document.getElementById("newRoom").onclick=function(){ye=[];for(var e=parseInt(document.getElementById("roomW").value),t=parseInt(document.getElementById("roomH").value),n=0;n<t;n++){for(var o=[],i=0;i<e;i++)o.push(new Pe(i,n,0,0,0));ye.push(o)}};var Ie=["TileGrass","TilePath","TileBrickPath","WallBrick"],ke={};class Be{constructor(e,t,n,o,i=0){this.x=16*e,this.y=16*t,this.tileID=n,this.variation=o,this.rotation=i*Math.PI/2}}Be.prototype.w=16,Be.prototype.h=16,Be.prototype.imageName="debug",Be.prototype.typesAmount=1,Be.prototype.mergesWith=[],Be.prototype.effect=0,Be.prototype.layer=0,Be.prototype.draw=function(){r(ee[`${this.imageName}${this.variation}`],this.x,this.y,this.rotation)},ke.Tile=Be;class Me extends Be{constructor(e,t,n,o,i=0){super(e,t,n,o,i)}}Me.prototype.effect=1,Me.prototype.layer=1,ke.BaseWall=Me;class Ce extends Be{constructor(e,t,n,o,i=0){super(e,t,n,o,i)}}Ce.prototype.imageName="brickPath",Ce.prototype.typesAmount=3,Ce.prototype.effect=2,ke.TileBrickPath=Ce;class Pe extends Be{constructor(e,t,n,o,i=0){super(e,t,n,o,i)}}Pe.prototype.imageName="grass",Pe.prototype.typesAmount=2,Pe.prototype.mergesWith=[0,1,3],ke.TileGrass=Pe;class ze extends Be{constructor(e,t,n,o,i=0){super(e,t,n,o,i)}}ze.prototype.imageName="path",ze.prototype.effect=2,ze.prototype.mergesWith=[3],ke.TilePath=ze;class Te extends Me{constructor(e,t,n,o,i=0){super(e,t,n,o,i)}}Te.prototype.imageName="brick",Te.prototype.typesAmount=4,ke.WallBrick=Te,F=["assets/images/",["tiles/","debug0.png","grass0.png","grass1.png","path0.png","brick0.png","brick1.png","brick2.png","brick3.png","brickPath0.png","brickPath1.png","brickPath2.png"],["objects/","tree0.png","tree1.png","link0.png","link1.png","houseSmall0.png"],["UI/slot","Accessory.png","Weapon.png","Select.png","Frame.png","Head.png","Body.png","Pants.png","Boots.png","Hand.png"],"preview0.png","tempPlayer.png","tempEnemy00.png","buildPen.png","buildBucket.png"],D=["assets/audio/"];var He=0;const Se=0,Fe=1,De=2,Re=3,Ge=4;var Qe,We,je,Le,Ne=Ge;Q=60,R.cvs=document.getElementById("game"),R.cvs.width=document.body.clientWidth,R.cvs.height=document.body.offsetHeight<window.innerHeight?window.innerHeight:document.body.offsetHeight,E=R.cvs.width,I=R.cvs.height,R.ctx=R.cvs.getContext("2d",{alpha:!1}),R.cvs.onmousedown=function(){W||(function(){var e="";function t(n,a){let r="";for(let c=0;c<n.length;c++){if("string"==typeof n[c])if(0==c)e+=n[c],r=n[c];else if("image"==a){let t=e+n[c];J.push(t);let i=new Image;i.src=t,i.onerror=function(){console.warn(U+" "+this.src+" was not found")},i.onload=function(){o(t,i)},_.push(i)}else"sound"==a&&(te.push(e+n[c]),i(e+n[c]));"object"==typeof n[c]&&t(n[c],a)}e=e.slice(0,e.length-r.length)}se=new AudioContext,(le=se.createGain()).connect(se.destination),(he=se.createGain()).connect(se.destination),t(F,"image"),t(D,"sound"),(H=new Image).src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAC4jAAAuIwF4pT92AAAAf0lEQVQ4jc2SuxHAIAxDbY4pMpHmyJSeKGuQKpyj2Hy6qETPQvhQCWRmDRfeZ4cJAGW28mAUyL4Pqmx2nfK+zaR59glRHo5qZi0BaPHmbDhiyuzdsza9wcrtEVtG4Ip+FLCzTM+WneWxPv9gpQUzmhncLPOHUCYfHr4/C4r2dQPfhkeIbjeYWgAAAABJRU5ErkJggg==",S=new Audio("data:audio/x-wav;base64,UklGRowBAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YWgBAADa/6T/2/+S/x//pP769Xr4fPh5+H34evh7+Pv6gf18/QIAhQcIDxUZFR4VHhgeEx6TFgkPCgqAAnz49/X18HLu7ubo4eXc5dzj3Gjf5+Fr5G7pce759YECiwwRFBQZlxuXG5cbFRmTFo8RCAoAAPz69/X08G7udO5s7vz1dvj++nv9gP3+/wEAgwKBAogHkBEpLUNG1lzqcPV683r4eu51ZmnVV7w+qypy88fDoKAXlAqKBoUAgIeHlpYsrTu87Ot9/ZIRGxkoKDEtqionIxgZiwfj5lnaz9JN0E3QV9pd3+Tm9fUBAAQFBwWNDBEPFxSYFpsWEA9+/fP1dfNt83bz8fX9+gQFkAwPDxQPEQ+IBwIAdfjv8OLm2+HX3Nrh4+bm63n4BAUUDx0ZqyCrJSkelBGEAnb4a+5a5Njcztxc31jkZunx9QgFGhQfGa0gqCCuIKkgpRsaFIsHdfhj6dfh0NzM19Th6es=");let a=E/2-100,r=I/2-100;Y.screenSize={x:a+160,y:r+12,w:50,h:20},Y.sfx={x:a+125,y:r+40,w:120,h:20},Y.bmg={x:a+125,y:r+70,w:120,h:20},n()}(),W=!0)},e("buffer1"),e("buffer2"),R.ctx.imageSmoothingEnabled=!1,R.buffer1ctx.imageSmoothingEnabled=!1,R.buffer2ctx.imageSmoothingEnabled=!1,T=(B=Math.max(R.cvs.width,R.cvs.height))-Math.min(R.cvs.width,R.cvs.height),I=R.cvs.height,E=R.cvs.width,(je=document.createElement("style")).innerHTML="\n    @font-face {\n        font-family: 'pixelmix';\n        src: url(assets/pixelmix.ttf) format('truetype');\n        font-weight: 900;\n        font-style: normal;\n    }\n    html {font-family: 'pixelmix' !important; font-size: 16px;}\n    ",document.head.appendChild(je),R.ctx.textBaseline="hanging",R.ctx.textAlign="left",function(){var e=document.createElement("style");e.id="gamejsstyle",document.head.appendChild(e);var t=document.createElement("meta");t.setAttribute("charset","utf-8"),document.head.appendChild(t)}(),Le=R.cvs,window.addEventListener("keydown",(function(e){var t=e.keyCode;f[t]=f[t]==[][[]]?1:0,m[t]=1})),window.addEventListener("keyup",(function(e){var t=e.keyCode;delete f[t],delete m[t]})),Le.addEventListener("mousedown",(function(e){var t=e.button;g[t]=g[t]==[][[]]?1:0,p[t]=1,e.preventDefault()})),Le.addEventListener("mouseup",(function(e){var t=e.button;delete g[t],delete p[t]})),Le.addEventListener("mousemove",(function(e){x.x=e.offsetX/1,x.y=e.offsetY/1})),Le.addEventListener("contextmenu",(function(e){e.preventDefault()})),Le.addEventListener("wheel",(function(e){y+=e.deltaY/100*-1,e.preventDefault()})),k=R.ctx,requestAnimationFrame((function e(){k.fillStyle="#2d2d2d",k.fillRect(0,0,E,I),s(E/2,I/2,27,"#066312"),s(E/2,I/2,23,"#149124"),l(E/2,I/2,[{x:-7,y:-15},{x:-7,y:15},{x:15,y:0}],"#47f55d"),W||requestAnimationFrame(e)}))